app/assets/javascripts/market.js.coffee:  CandlestickUI.attachTo('#candlestick')
app/assets/javascripts/component_ui/candlestick.js.coffee:@CandlestickUI = flight.component ->
config/locales/server.ko.yml:    candlestick: 'Candlestick'
config/locales/server.en.yml:        title: Candlestick Charts
config/locales/server.en.yml:    candlestick: 'Candlestick'
public/assets/market-0d98c78c0533a076bbbe1ed18804daad.js:}}(this)),channel.bind("order",function(_this){return function(data){return _this.trigger("order::"+data.state,data)}}(this)),channel.bind("trade",function(_this){return function(data){return _this.trigger("trade",data)}}(this)),this.trigger("account::update",gon.accounts),gon.my_orders&&this.trigger("order::wait::populate",{orders:gon.my_orders}),gon.my_trades?this.trigger("trade::populate",{trades:gon.my_trades}):void 0})})}.call(this),function(){this.PlaceOrderData=flight.component(function(){return this.onInput=function(event,data){var _ref;return _ref=data.variables,this.input=_ref.input,this.known=_ref.known,this.output=_ref.output,this.order[this.input]=data.value,this.order[this.input]&&this.order[this.known]?this.trigger("place_order::output::"+this.output,this.order):void 0},this.onReset=function(event,data){var _ref;return _ref=data.variables,this.input=_ref.input,this.known=_ref.known,this.output=_ref.output,this.order[this.input]=this.order[this.output]=null,this.trigger("place_order::reset::"+this.output),this.trigger("place_order::order::updated",this.order)},this.after("initialize",function(){return this.order={price:null,volume:null,total:null},this.on("place_order::input",this.onInput),this.on("place_order::reset",this.onReset)})})}.call(this),function(){this.AccountBalanceUI=flight.component(function(){return this.updateAccount=function(event,data){var account,currency,symbol,total,_results;_results=[];for(currency in data)account=data[currency],symbol=gon.currencies[currency].symbol||"",this.$node.find(".account."+currency+" span.balance").text(""+account.balance),this.$node.find(".account."+currency+" span.locked").text(""+account.locked),total=new BigNumber(account.locked).plus(new BigNumber(account.balance)),_results.push(this.$node.find(".account."+currency+" span.total").text(""+symbol+formatter.round(total,2)));return _results},this.updateTotalAssets=function(event,data){var account,currency,fiatCurrency,sum,symbol,ticker;fiatCurrency=gon.fiat_currency,symbol=gon.currencies[fiatCurrency].symbol,sum=0;for(currency in data)account=data[currency],currency===fiatCurrency?(sum+=+account.balance,sum+=+account.locked):(ticker=gon.tickers[""+currency+fiatCurrency])&&(sum+=+account.balance*+ticker.last,sum+=+account.locked*+ticker.last);return this.$node.find(".total-assets").text(" ≈ "+symbol+" "+formatter.round(sum,2))},this.after("initialize",function(){return this.on(document,"account::update",this.updateAccount),this.on(document,"account::update",this.updateTotalAssets)})})}.call(this),function(){this.AccountSummaryUI=flight.component(function(){return this.attributes({total_assets:"#total_assets"}),this.updateAccount=function(event,data){var account,amount,currency,_results;_results=[];for(currency in data)account=data[currency],amount=new BigNumber(account.locked).plus(new BigNumber(account.balance)),this.$node.find("tr."+currency+" span.amount").text(formatter.round(amount,2)),_results.push(this.$node.find("tr."+currency+" span.locked").text(formatter.round(account.locked,2)));return _results},this.updateTotalAssets=function(){var account,currency,fiatCurrency,sum,symbol,ticker,_ref;fiatCurrency=gon.fiat_currency,symbol=gon.currencies[fiatCurrency].symbol,sum=0,_ref=this.accounts;for(currency in _ref)account=_ref[currency],currency===fiatCurrency?(sum+=+account.balance,sum+=+account.locked):(ticker=this.tickers[""+currency+fiatCurrency])&&(sum+=+account.balance*+ticker.last,sum+=+account.locked*+ticker.last);return this.select("total_assets").text(""+symbol+formatter.round(sum,2))},this.after("initialize",function(){return this.accounts=gon.accounts,this.tickers=gon.tickers,this.on(document,"account::update",this.updateAccount),this.on(document,"account::update",function(_this){return function(event,data){return _this.accounts=data,_this.updateTotalAssets()}}(this)),this.on(document,"market::tickers",function(_this){return function(event,data){return _this.tickers=data.raw,_this.updateTotalAssets()}}(this))})})}.call(this),function(){var BORDER_WIDTH,GUTTER,PANEL_PADDING,PANEL_TABLE_HEADER_HIGH;GUTTER=2,PANEL_TABLE_HEADER_HIGH=37,PANEL_PADDING=8,BORDER_WIDTH=1,this.AutoWindowUI=flight.component(function(){return this.after("initialize",function(){var gutter,gutter_2x,gutter_3x,gutter_4x,gutter_5x,gutter_6x,gutter_7x,gutter_8x,gutter_9x,panel_table_header_high;return gutter=GUTTER,gutter_2x=2*GUTTER,gutter_3x=3*GUTTER,gutter_4x=4*GUTTER,gutter_5x=5*GUTTER,gutter_6x=6*GUTTER,gutter_7x=7*GUTTER,gutter_8x=8*GUTTER,gutter_9x=9*GUTTER,panel_table_header_high=PANEL_TABLE_HEADER_HIGH,this.$node.resize(function(){var depths_h,entry_h,markets_h,markets_w,my_orders_h,navbar_h,order_book_w,order_h,ticker_h,trades_h,window_h,window_w;return navbar_h=$(".navbar").height()+BORDER_WIDTH,markets_h=$("#market_list").height()+BORDER_WIDTH,entry_h=$("#ask_entry").height()+2*BORDER_WIDTH,depths_h=$("#depths_wrapper").height()+2*BORDER_WIDTH,my_orders_h=$("#my_orders").height()+2*BORDER_WIDTH,ticker_h=$("#ticker").height()+2*BORDER_WIDTH,window_h=$(this).height(),$(".content").height(window_h-navbar_h),$("#candlestick").height(window_h-navbar_h-gutter_3x),order_h=window_h-navbar_h-entry_h-depths_h-my_orders_h-ticker_h-gutter_6x-2*BORDER_WIDTH,$("#order_book").height(order_h),$("#order_book .panel-body-content").height(order_h-panel_table_header_high-2*PANEL_PADDING),trades_h=window_h-navbar_h-markets_h-gutter_3x-BORDER_WIDTH,$("#market_trades").height(trades_h),$("#market_trades .panel").height(trades_h-2*BORDER_WIDTH),$("#market_trades .panel-body-content").height(trades_h-2*BORDER_WIDTH-panel_table_header_high-2*PANEL_PADDING),window_w=window.innerWidth,markets_w=$("#market_list").width(),order_book_w=$("#order_book").width(),$("#candlestick").width(window_w-order_book_w-markets_w-gutter_4x-20)}),this.$node.resize()})})}.call(this),function(){var COLOR,COLOR_OFF,COLOR_ON,DATETIME_LABEL_FORMAT,DATETIME_LABEL_FORMAT_FOR_TOOLTIP,INDICATOR,RANGE_DEFAULT;"zh-CN"===gon.local&&(DATETIME_LABEL_FORMAT_FOR_TOOLTIP={millisecond:["%m月%e日, %H:%M:%S.%L","%m月%e日, %H:%M:%S.%L","-%H:%M:%S.%L"],second:["%m月%e日, %H:%M:%S","%m月%e日, %H:%M:%S","-%H:%M:%S"],minute:["%m月%e日, %H:%M","%m月%e日, %H:%M","-%H:%M"],hour:["%m月%e日, %H:%M","%m月%e日, %H:%M","-%H:%M"],day:["%m月%e日, %H:%M","%m月%e日, %H:%M","-%H:%M"],week:["%Y年%m月%e日","%Y年%m月%e日","-%m月%e日"],month:["%Y年%m月","%Y年%m月","-%m"],year:["%Y","%Y","-%Y"]}),DATETIME_LABEL_FORMAT={second:"%H:%M:%S",minute:"%H:%M",hour:"%H:%M",day:"%m-%d",week:"%m-%d",month:"%Y-%m",year:"%Y"},RANGE_DEFAULT={fill:"none",stroke:"none","stroke-width":0,r:8,style:{color:"#333"},states:{hover:{fill:"#000",style:{color:"#ccc"}},select:{fill:"#000",style:{color:"#eee"}}}},COLOR_ON={candlestick:{color:"#990f0f",upColor:"#000000",lineColor:"#cc1414",upLineColor:"#49c043"},close:{color:null}},COLOR_OFF={candlestick:{color:"invalid",upColor:"invalid",lineColor:"invalid",upLineColor:"invalid"},close:{color:"invalid"}},COLOR={candlestick:_.extend({},COLOR_OFF.candlestick),close:_.extend({},COLOR_OFF.close)},INDICATOR={MA:!1,EMA:!1},this.CandlestickUI=flight.component(function(){return this.mask=function(){return this.$node.find(".mask").show()},this.unmask=function(){return this.$node.find(".mask").hide()},this.request=function(){return this.mask()},this.init=function(event,data){var _ref;return this.running=!0,null!=(_ref=this.$node.find("#candlestick_chart").highcharts())&&_ref.destroy(),this.initHighStock(data),this.trigger("market::candlestick::created",data)},this.switchType=function(event,data){var chart,colors,key,s,type,val,_i,_len,_ref;for(key in COLOR)val=COLOR[key],_.extend(COLOR[key],COLOR_OFF[key]);if(_.extend(COLOR[data.x],COLOR_ON[data.x]),chart=this.$node.find("#candlestick_chart").highcharts()){for(type in COLOR)for(colors=COLOR[type],_ref=chart.series,_i=0,_len=_ref.length;_len>_i;_i++)s=_ref[_i],null==s.userOptions.algorithm&&s.userOptions.id===type&&s.update(colors,!1);return this.trigger("switch::main_indicator_switch::init")}},this.switchMainIndicator=function(event,data){var chart,indicator,key,s,val,visible,_i,_j,_len,_len1,_ref,_ref1;for(key in INDICATOR)val=INDICATOR[key],INDICATOR[key]=!1;if(INDICATOR[data.x]=!0,chart=this.$node.find("#candlestick_chart").highcharts()){for(_ref=chart.series,_i=0,_len=_ref.length;_len>_i;_i++)s=_ref[_i],"close"===s.userOptions.linkedTo&&s.setVisible(!0,!1);for(indicator in INDICATOR)for(visible=INDICATOR[indicator],_ref1=chart.series,_j=0,_len1=_ref1.length;_len1>_j;_j++)s=_ref1[_j],null!=s.userOptions.algorithm&&s.userOptions.algorithm===indicator&&s.setVisible(visible,!1);return chart.redraw()}},this.default_range=function(unit){return 6e4*unit*100},this.initHighStock=function(data){var component,dataGrouping,range,timeUnits,title,tooltipTemplate,unit;return component=this,range=this.default_range(data.minutes),unit=$("[data-unit="+data.minutes+"]").text(),title=""+gon.market.base_unit.toUpperCase()+"/"+gon.market.quote_unit.toUpperCase()+" - "+unit,timeUnits={millisecond:1,second:1e3,minute:6e4,hour:36e5,day:864e5,week:6048e5,month:26784e5,year:31556952e3},dataGrouping={enabled:!1},tooltipTemplate=JST["templates/tooltip"],DATETIME_LABEL_FORMAT_FOR_TOOLTIP&&(dataGrouping.dateTimeLabelFormats=DATETIME_LABEL_FORMAT_FOR_TOOLTIP),this.$node.find("#candlestick_chart").highcharts("StockChart",{chart:{events:{load:function(_this){return function(){return _this.unmask()}}(this)},animation:!0,marginTop:95,backgroundColor:"rgba(0,0,0, 0.0)"},credits:{enabled:!1},tooltip:{crosshairs:[{width:.5,dashStyle:"solid",color:"#777"},!1],valueDecimals:gon.market.bid.fixed,borderWidth:0,backgroundColor:"rgba(0,0,0,0)",borderRadius:2,shadow:!1,shared:!0,positioner:function(w,h,point){var chart_h,chart_w,grid_h,x,y;return chart_w=$(this.chart.renderTo).width(),chart_h=$(this.chart.renderTo).height(),grid_h=Math.min(20,Math.ceil(chart_h/10)),x=Math.max(10,point.plotX-w-20),y=Math.max(0,Math.floor(point.plotY/grid_h)*grid_h-20),{x:x,y:y}},useHTML:!0,formatter:function(){var chart,dateFormat,dateTimeLabelFormats,fun,index,k,key,series,v;chart=this.points[0].series.chart,series=this.points[0].series,index=this.points[0].point.index,key=this.points[0].key;for(k in timeUnits)if(v=timeUnits[k],v>=series.xAxis.closestPointRange||v<=timeUnits.day&&key%v>0){dateFormat=dateTimeLabelFormats=series.options.dataGrouping.dateTimeLabelFormats[k][0],title=Highcharts.dateFormat(dateFormat,key);break}return fun=function(h,s){return h[s.options.id]=s.data[index],h},tooltipTemplate({title:title,indicator:INDICATOR,format:function(v,fixed){return null==fixed&&(fixed=3),Highcharts.numberFormat(v,fixed)},points:_.reduce(chart.series,fun,{})})}},plotOptions:{candlestick:{turboThreshold:0,followPointer:!0,color:"#990f0f",upColor:"#000000",lineColor:"#cc1414",upLineColor:"#49c043",dataGrouping:dataGrouping},column:{turboThreshold:0,dataGrouping:dataGrouping},trendline:{lineWidth:1},histogram:{lineWidth:1,tooltip:{pointFormat:"<li><span style='color: {series.color};'>{series.name}: <b>{point.y}</b></span></li>"}}},scrollbar:{buttonArrowColor:"#333",barBackgroundColor:"#202020",buttonBackgroundColor:"#202020",trackBackgroundColor:"#202020",barBorderColor:"#2a2a2a",buttonBorderColor:"#2a2a2a",trackBorderColor:"#2a2a2a"},rangeSelector:{enabled:!1},navigator:{maskFill:"rgba(32, 32, 32, 0.6)",outlineColor:"#333",outlineWidth:1,xAxis:{dateTimeLabelFormats:DATETIME_LABEL_FORMAT}},xAxis:{type:"datetime",dateTimeLabelFormats:DATETIME_LABEL_FORMAT,lineColor:"#333",tickColor:"#333",tickWidth:2,range:range,events:{afterSetExtremes:function(e){return"navigator"===e.trigger&&"navigator-drag"===e.triggerOp&&component.liveRange(this.chart)&&!component.running?component.trigger("switch::range_switch::init"):void 0}}},yAxis:[{labels:{enabled:!0,align:"right",x:2,y:3,zIndex:-7},gridLineColor:"#222",gridLineDashStyle:"ShortDot",top:"0%",height:"70%",lineColor:"#fff",minRange:gon.ticker.last?parseFloat(gon.ticker.last)/25:null},{labels:{enabled:!1},top:"70%",gridLineColor:"#000",height:"15%"},{labels:{enabled:!1},top:"85%",gridLineColor:"#000",height:"15%"}],series:[_.extend({id:"candlestick",name:gon.i18n.chart.candlestick,type:"candlestick",data:data.candlestick,showInLegend:!1},COLOR.candlestick),_.extend({id:"close",type:"spline",data:data.close,showInLegend:!1,marker:{radius:0}},COLOR.close),{id:"volume",name:gon.i18n.chart.volume,yAxis:1,type:"column",data:data.volume,color:"#777",showInLegend:!1},{id:"ma5",name:"MA5",linkedTo:"close",showInLegend:!0,type:"trendline",algorithm:"MA",periods:5,color:"#7c9aaa",visible:INDICATOR.MA,marker:{radius:0}},{id:"ma10",name:"MA10",linkedTo:"close",showInLegend:!0,type:"trendline",algorithm:"MA",periods:10,color:"#be8f53",visible:INDICATOR.MA,marker:{radius:0}},{id:"ema7",name:"EMA7",linkedTo:"close",showInLegend:!0,type:"trendline",algorithm:"EMA",periods:7,color:"#7c9aaa",visible:INDICATOR.EMA,marker:{radius:0}},{id:"ema30",name:"EMA30",linkedTo:"close",showInLegend:!0,type:"trendline",algorithm:"EMA",periods:30,color:"#be8f53",visible:INDICATOR.EMA,marker:{radius:0}},{id:"macd",name:"MACD",linkedTo:"close",yAxis:2,showInLegend:!0,type:"trendline",algorithm:"MACD",color:"#7c9aaa",marker:{radius:0}},{id:"sig",name:"SIG",linkedTo:"close",yAxis:2,showInLegend:!0,type:"trendline",algorithm:"signalLine",color:"#be8f53",marker:{radius:0}},{id:"hist",name:"HIST",linkedTo:"close",yAxis:2,showInLegend:!0,type:"histogram",color:"#990f0f"}]})},this.formatPointArray=function(point){return{x:point[0],open:point[1],high:point[2],low:point[3],close:point[4]}},this.createPointOnSeries=function(chart,i,px,point){return chart.series[i].addPoint(point,!0,!0)},this.createPoint=function(chart,data,i){return this.createPointOnSeries(chart,0,data.candlestick[i][0],data.candlestick[i]),this.createPointOnSeries(chart,1,data.close[i][0],data.close[i]),this.createPointOnSeries(chart,2,data.volume[i].x,data.volume[i]),chart.redraw(!0)},this.updatePointOnSeries=function(chart,i,px,point){var last;return chart.series[i].points?(last=chart.series[i].points[chart.series[i].points.length-1],px===last.x?last.update(point,!1):console.log("Error update on series "+i+": px="+px+" lastx="+last.x)):void 0},this.updatePoint=function(chart,data,i){return this.updatePointOnSeries(chart,0,data.candlestick[i][0],this.formatPointArray(data.candlestick[i])),this.updatePointOnSeries(chart,1,data.close[i][0],data.close[i][1]),this.updatePointOnSeries(chart,2,data.volume[i].x,data.volume[i]),chart.redraw(!0)},this.process=function(chart,data){var current,current_point,i,_i,_ref,_results;for(_results=[],i=_i=0,_ref=data.candlestick.length-1;_ref>=0?_ref>=_i:_i>=_ref;i=_ref>=0?++_i:--_i)current=chart.series[0].points.length-1,current_point=chart.series[0].points[current],data.candlestick[i][0]>current_point.x?_results.push(this.createPoint(chart,data,i)):_results.push(this.updatePoint(chart,data,i));return _results},this.updateByTrades=function(event,data){var chart;return chart=this.$node.find("#candlestick_chart").highcharts(),this.liveRange(chart)?this.process(chart,data):this.running=!1},this.liveRange=function(chart){var p1,p2;return p1=chart.series[0].points[chart.series[0].points.length-1].x,p2=chart.series[10].points[chart.series[10].points.length-1].x,p1===p2},this.after("initialize",function(){return this.on(document,"market::candlestick::request",this.request),this.on(document,"market::candlestick::response",this.init),this.on(document,"market::candlestick::trades",this.updateByTrades),this.on(document,"switch::main_indicator_switch",this.switchMainIndicator),this.on(document,"switch::type_switch",this.switchType)})})}.call(this),function(){this.DepthUI=flight.component(function(){return this.attributes({chart:"#depths"}),this.refresh=function(event,data){var chart;return chart=this.select("chart").highcharts(),chart.series[0].setData(data.bids.reverse(),!1),chart.series[1].setData(data.asks,!1),chart.xAxis[0].setExtremes(data.low,data.high),chart.redraw()},this.initChart=function(){return this.select("chart").highcharts({chart:{margin:0,height:100,backgroundColor:"rgba(0,0,0,0)"},title:{text:""},credits:{enabled:!1},legend:{enabled:!1},rangeSelector:{enabled:!1},xAxis:{labels:{enabled:!1}},yAxis:{min:0,gridLineColor:"#333",gridLineDashStyle:"ShortDot",title:{text:""},labels:{enabled:!1}},tooltip:{valueDecimals:4,headerFormat:"<table class=depths-table><tr>\n  <th><span>{series.name}</span> "+gon.i18n.chart.price+"</th><th>"+gon.i18n.chart.depth+"</th>\n</tr>",pointFormat:"<tr><td>{point.x}</td><td>{point.y}</td></tr>",footerFormat:"</table>",borderWidth:0,backgroundColor:"rgba(0,0,0,0)",borderRadius:0,shadow:!1,useHTML:!0,shared:!0,positioner:function(){return{x:128,y:28}}},series:[{name:gon.i18n.bid,type:"area",fillColor:"rgba(77, 215, 16, 0.5)",lineColor:"rgb(77, 215, 16)",color:"transparent",animation:{duration:1e3}},{name:gon.i18n.ask,type:"area",animation:{duration:1e3},fillColor:"rgba(208, 0, 23, 0.3)",lineColor:"rgb(208, 0, 23)",color:"transparent"}]})},this.after("initialize",function(){return this.initChart(),this.on(document,"market::depth::response",this.refresh),this.on(document,"market::depth::fade_toggle",function(){return this.$node.fadeToggle()}),this.on(this.select("close"),"click",function(_this){return function(){return _this.trigger("market::depth::fade_toggle")}}(this))})})}.call(this),function(){this.FlashMessageUI=flight.component(function(){return this.showMeg=function(data){var template;return this.$node.html(""),template=JST["templates/flash_message"](data),$(template).prependTo(this.$node)},this.info=function(event,data){return data.info=!0,this.showMeg(data)},this.notice=function(event,data){return data.notice=!0,this.showMeg(data)},this.alert=function(event,data){return data.alert=!0,this.showMeg(data)},this.after("initialize",function(){return this.on(document,"flash:info",this.info),this.on(document,"flash:notice",this.notice),this.on(document,"flash:alert",this.alert)})})}.call(this),function(){this.FloatUI=flight.component(function(){return this.attributes({action:"ul.nav.nav-tabs > li",close:"i.fa.fa-close"}),this.after("initialize",function(){return this.select("action").click(function(_this){return function(e){return _this.select("action").length>1?_this.$node.hasClass("hover")&&$(e.currentTarget).hasClass("active")?_this.select("close").click():_this.$node.addClass("hover"):_this.$node.hasClass("hover")?_this.select("close").click():_this.$node.addClass("hover")}}(this)),this.select("close").click(function(_this){return function(){return _this.$node.removeClass("hover"),_this.select("action").removeClass("active")}}(this))})})}.call(this),function(){this.HeaderUI=flight.component(function(){return this.attributes({vol:"span.vol",amount:"span.amount",high:"span.high",low:"span.low",change:"span.change",sound:'input[name="sound-checkbox"]'}),this.refresh=function(event,ticker){var p1,p2,trend;return this.select("vol").text(""+ticker.volume+" "+gon.market.base_unit.toUpperCase()),this.select("high").text(ticker.high),this.select("low").text(ticker.low),p1=parseFloat(ticker.open),p2=parseFloat(ticker.last),trend=formatter.trend(p2>=p1),this.select("change").html("<span class='"+trend+"'>"+formatter.price_change(p1,p2)+"%</span>")},this.after("initialize",function(){var state,_ref;return this.on(document,"market::ticker",this.refresh),void 0===Cookies.get("sound")&&Cookies.set("sound",!0,30),state=null!=(_ref="true"===Cookies.get("sound"))?_ref:{"true":!1},this.select("sound").bootstrapSwitch({labelText:gon.i18n["switch"].sound,state:state,handleWidth:40,labelWidth:40,onSwitchChange:function(event,state){return Cookies.set("sound",state,30)}}),$("header .dropdown-menu").click(function(e){return e.stopPropagation()})})})}.call(this),function(){var ESC;ESC=27,this.KeyBindUI=flight.component(function(){return this.after("initialize",function(){var entry;return entry="#ask_entry",this.$node.on("keyup",function(e){return e.keyCode===ESC?(entry="#bid_entry"===entry?"#ask_entry":"#bid_entry",$(entry).trigger("place_order::clear")):void 0})})})}.call(this),function(){window.MarketSwitchUI=flight.component(function(){return this.attributes({table:"tbody",marketGroupName:".panel-body-head thead span.name",marketGroupItem:".dropdown-wrapper .dropdown-menu li a",marketsTable:".table.markets"}),this.switchMarketGroup=function(event,item){var name;return item=$(event.target).closest("a"),name=item.data("name"),this.select("marketGroupItem").removeClass("active"),item.addClass("active"),this.select("marketGroupName").text(item.find("span").text()),this.select("marketsTable").attr("class","table table-hover markets "+name)},this.updateMarket=function(select,ticker){var p1,p2,trend;return trend=formatter.trend(ticker.last_trend),select.find("td.price").attr("title",ticker.last).html("<span class='"+trend+"'>"+formatter.ticker_price(ticker.last)+"</span>"),p1=parseFloat(ticker.open),p2=parseFloat(ticker.last),trend=formatter.trend(p2>=p1),select.find("td.change").html("<span class='"+trend+"'>"+formatter.price_change(p1,p2)+"%</span>")},this.refresh=function(event,data){var table,ticker,_i,_len,_ref;for(table=this.select("table"),_ref=data.tickers,_i=0,_len=_ref.length;_len>_i;_i++)ticker=_ref[_i],this.updateMarket(table.find("tr#market-list-"+ticker.market),ticker.data);return table.find("tr#market-list-"+gon.market.id).addClass("highlight")},this.after("initialize",function(){return this.on(document,"market::tickers",this.refresh),this.on(this.select("marketGroupItem"),"click",this.switchMarketGroup),this.select("table").on("click","tr",function(e){return"I"!==e.target.nodeName?window.location.href=window.formatter.market_url($(this).data("market")):void 0}),this.hide_accounts=$("tr.hide"),$(".view_all_accounts").on("click",function(_this){return function(e){var $el;return $el=$(e.currentTarget),_this.hide_accounts.hasClass("hide")?($el.text($el.data("hide-text")),_this.hide_accounts.removeClass("hide")):($el.text($el.data("show-text")),_this.hide_accounts.addClass("hide"))}}(this))})})}.call(this),function(){window.MarketTickerUI=flight.component(function(){return this.attributes({askSelector:".ask .price",bidSelector:".bid .price",lastSelector:".last .price",priceSelector:".price"}),this.updatePrice=function(selector,price,trend){return selector.removeClass("text-up").removeClass("text-down").addClass(formatter.trend(trend)),selector.html(formatter.fixBid(price))},this.refresh=function(event,ticker){return this.updatePrice(this.select("askSelector"),ticker.sell,ticker.sell_trend),this.updatePrice(this.select("bidSelector"),ticker.buy,ticker.buy_trend),this.updatePrice(this.select("lastSelector"),ticker.last,ticker.last_trend)},this.after("initialize",function(){return this.on(document,"market::ticker",this.refresh)})})}.call(this),function(){window.MarketTradesUI=flight.component(function(){return flight.compose.mixin(this,[NotificationMixin]),this.attributes({defaultHeight:156,tradeSelector:"tr",newTradeSelector:"tr.new",allSelector:"a.all",mySelector:"a.my",allTableSelector:"table.all-trades tbody",myTableSelector:"table.my-trades tbody",newMarketTradeContent:"table.all-trades tr.new div",newMyTradeContent:"table.my-trades tr.new div",tradesLimit:80}),this.showAllTrades=function(){return this.select("mySelector").removeClass("active"),this.select("allSelector").addClass("active"),this.select("myTableSelector").hide(),this.select("allTableSelector").show()},this.showMyTrades=function(){return this.select("allSelector").removeClass("active"),this.select("mySelector").addClass("active"),this.select("allTableSelector").hide(),this.select("myTableSelector").show()},this.bufferMarketTrades=function(event,data){return this.marketTrades=this.marketTrades.concat(data.trades)},this.clearMarkers=function(table){return table.find("tr.new").removeClass("new"),table.find("tr").slice(this.attr.tradesLimit).remove()},this.notifyMyTrade=function(trade){var market,message;return market=gon.markets[trade.market],message=gon.i18n.notification.new_trade.replace(/%{kind}/g,gon.i18n[trade.kind]).replace(/%{id}/g,trade.id).replace(/%{price}/g,trade.price).replace(/%{volume}/g,trade.volume).replace(/%{base_unit}/g,market.base_unit.toUpperCase()).replace(/%{quote_unit}/g,market.quote_unit.toUpperCase()),this.notify(message)},this.isMine=function(trade){var t,_i,_len,_ref;if(0===this.myTrades.length)return!1;for(_ref=this.myTrades,_i=0,_len=_ref.length;_len>_i;_i++){if(t=_ref[_i],trade.tid===t.id)return!0;if(trade.tid>t.id)return!1}},this.handleMarketTrades=function(event,data){var el,trade,_i,_len,_ref;for(_ref=data.trades,_i=0,_len=_ref.length;_len>_i;_i++)trade=_ref[_i],this.marketTrades.unshift(trade),trade.classes="new",this.isMine(trade)&&(trade.classes+=" mine"),el=this.select("allTableSelector").prepend(JST["templates/market_trade"](trade));return this.marketTrades=this.marketTrades.slice(0,this.attr.tradesLimit),this.select("newMarketTradeContent").slideDown("slow"),setTimeout(function(_this){return function(){return _this.clearMarkers(_this.select("allTableSelector"))}}(this),900)},this.handleMyTrades=function(event,data,notify){var el,trade,_i,_len,_ref;for(null==notify&&(notify=!0),_ref=data.trades,_i=0,_len=_ref.length;_len>_i;_i++)trade=_ref[_i],trade.market===gon.market.id&&(this.myTrades.unshift(trade),trade.classes="new",el=this.select("myTableSelector").prepend(JST["templates/my_trade"](trade)),this.select("allTableSelector").find("tr#market-trade-"+trade.id).addClass("mine")),notify&&this.notifyMyTrade(trade);return this.myTrades.length>this.attr.tradesLimit&&(this.myTrades=this.myTrades.slice(0,this.attr.tradesLimit)),this.select("newMyTradeContent").slideDown("slow"),setTimeout(function(_this){return function(){return _this.clearMarkers(_this.select("myTableSelector"))}}(this),900)},this.after("initialize",function(){return this.marketTrades=[],this.myTrades=[],this.on(document,"trade::populate",function(_this){return function(event,data){return _this.handleMyTrades(event,{trades:data.trades.reverse()},!1)}}(this)),this.on(document,"trade",function(_this){return function(event,trade){return _this.handleMyTrades(event,{trades:[trade]})}}(this)),this.on(document,"market::trades",this.handleMarketTrades),this.on(this.select("allSelector"),"click",this.showAllTrades),this.on(this.select("mySelector"),"click",this.showMyTrades)})})}.call(this),function(){this.MyOrdersUI=flight.component(function(){return flight.compose.mixin(this,[ItemListMixin]),this.getTemplate=function(order){return $(JST["templates/order_active"](order))},this.orderHandler=function(event,order){if(order.market===gon.market.id)switch(order.state){case"wait":return this.addOrUpdateItem(order);case"cancel":return this.removeItem(order.id);case"done":return this.removeItem(order.id)}},this.cancelOrder=function(event){var tr;return tr=$(event.target).parents("tr"),confirm(formatter.t("place_order").confirm_cancel)?$.ajax({url:formatter.market_url(gon.market.id,tr.data("id")),method:"delete"}):void 0},this.after("initialize",function(){return this.on(document,"order::wait::populate",this.populate),this.on(document,"order::wait order::cancel order::done",this.orderHandler),this.on(this.select("tbody"),"click",this.cancelOrder)})})}.call(this),function(){this.OrderBookUI=flight.component(function(){return this.attributes({bookLimit:30,askBookSel:"table.asks",bidBookSel:"table.bids",seperatorSelector:"table.seperator",fade_toggle_depth:"#fade_toggle_depth"}),this.update=function(event,data){return this.updateOrders(this.select("bidBookSel"),_.first(data.bids,this.attr.bookLimit),"bid"),this.updateOrders(this.select("askBookSel"),_.first(data.asks,this.attr.bookLimit),"ask")},this.appendRow=function(book,template,data){return data.classes="new",book.append(template(data))},this.insertRow=function(book,row,template,data){return data.classes="new",row.before(template(data))},this.updateRow=function(row,order,index,v1,v2){return row.data("order",index),v1.equals(v2)?void 0:(v2.greaterThan(v1)?row.addClass("text-up"):row.addClass("text-down"),row.data("volume",order[1]),row.find("td.volume").html(formatter.mask_fixed_volume(order[1])),row.find("td.amount").html(formatter.amount(order[1],order[0])))},this.mergeUpdate=function(bid_or_ask,book,orders,template){var $row,i,j,order,p1,p2,row,rows,v1,v2,_results;for(rows=book.find("tr"),i=j=0,_results=[];;)if(row=rows[i],order=orders[j],$row=$(row),row&&order)p1=new BigNumber($row.data("price")),v1=new BigNumber($row.data("volume")),p2=new BigNumber(order[0]),v2=new BigNumber(order[1]),"ask"===bid_or_ask&&p2.lessThan(p1)||"bid"===bid_or_ask&&p2.greaterThan(p1)?(this.insertRow(book,$row,template,{price:order[0],volume:order[1],index:j}),_results.push(j+=1)):p1.equals(p2)?(this.updateRow($row,order,j,v1,v2),i+=1,_results.push(j+=1)):($row.addClass("obsolete"),_results.push(i+=1));else if(row)$row.addClass("obsolete"),_results.push(i+=1);else{if(!order)break;this.appendRow(book,template,{price:order[0],volume:order[1],index:j}),_results.push(j+=1)}return _results},this.clearMarkers=function(book){var obsolete,obsolete_divs;return book.find("tr.new").removeClass("new"),book.find("tr.text-up").removeClass("text-up"),book.find("tr.text-down").removeClass("text-down"),obsolete=book.find("tr.obsolete"),obsolete_divs=book.find("tr.obsolete div"),obsolete_divs.slideUp("slow",function(){return obsolete.remove()})},this.updateOrders=function(table,orders,bid_or_ask){var book;return book=this.select(""+bid_or_ask+"BookSel"),this.mergeUpdate(bid_or_ask,book,orders,JST["templates/order_book_"+bid_or_ask]),book.find("tr.new div").slideDown("slow"),setTimeout(function(_this){return function(){return _this.clearMarkers(_this.select(""+bid_or_ask+"BookSel"))}}(this),900)},this.computeDeep=function(event,orders){var index,origVolume,price,volume,volume_fun;return index=Number($(event.currentTarget).data("order")),orders=_.take(orders,index+1),volume_fun=function(memo,num){return memo.plus(BigNumber(num[1]))},volume=_.reduce(orders,volume_fun,BigNumber(0)),price=BigNumber(_.last(orders)[0]),origVolume=_.last(orders)[1],{price:price,volume:volume,origVolume:origVolume}},this.placeOrder=function(target,data){return this.trigger(target,"place_order::input::price",data),this.trigger(target,"place_order::input::volume",data)},this.after("initialize",function(){return this.on(document,"market::order_book::update",this.update),this.on(this.select("fade_toggle_depth"),"click",function(_this){return function(){return _this.trigger("market::depth::fade_toggle")}}(this)),$(".asks").on("click","tr",function(_this){return function(e){var i;return i=$(e.target).closest("tr").data("order"),_this.placeOrder($("#bid_entry"),_.extend(_this.computeDeep(e,gon.asks),{type:"ask"})),_this.placeOrder($("#ask_entry"),{price:BigNumber(gon.asks[i][0]),volume:BigNumber(gon.asks[i][1])})}}(this)),$(".bids").on("click","tr",function(_this){return function(e){var i;return i=$(e.target).closest("tr").data("order"),_this.placeOrder($("#ask_entry"),_.extend(_this.computeDeep(e,gon.bids),{type:"bid"})),_this.placeOrder($("#bid_entry"),{price:BigNumber(gon.bids[i][0]),volume:BigNumber(gon.bids[i][1])})}}(this))})})}.call(this),function(){this.OrderPriceUI=flight.component(function(){return flight.compose.mixin(this,[OrderInputMixin]),this.attributes({precision:gon.market.bid.fixed,variables:{input:"price",known:"volume",output:"total"}}),this.getLastPrice=function(){return Number(gon.ticker.last)},this.toggleAlert=function(){var lastPrice;switch(lastPrice=this.getLastPrice(),!1){case!!this.value:return this.trigger("place_order::price_alert::hide");case!(this.value>1.1*lastPrice):return this.trigger("place_order::price_alert::show",{label:"price_high"});case!(this.value<.9*lastPrice):return this.trigger("place_order::price_alert::show",{label:"price_low"});default:return this.trigger("place_order::price_alert::hide")}},this.onOutput=function(event,order){var price;return price=order.total.div(order.volume),this.$node.val(price)},this.after("initialize",function(){return this.on("focusout",this.toggleAlert)})})}.call(this),function(){this.OrderTotalUI=flight.component(function(){return flight.compose.mixin(this,[OrderInputMixin]),this.attributes({precision:gon.market.bid.fixed,variables:{input:"total",known:"price",output:"volume"}}),this.onOutput=function(event,order){var total;return total=order.price.times(order.volume),this.validateRange(total)||this.changeOrder(this.value),this.setInputValue(this.value),order.total=this.value,this.trigger("place_order::order::updated",order)}})}.call(this),function(){this.OrderVolumeUI=flight.component(function(){return flight.compose.mixin(this,[OrderInputMixin]),this.attributes({precision:gon.market.ask.fixed,variables:{input:"volume",known:"price",output:"total"}}),this.onOutput=function(event,order){var volume;
public/assets/market-0d98c78c0533a076bbbe1ed18804daad.js:if(!order.price.equals(0))return volume=order.total.div(order.price),this.validateRange(volume)||this.changeOrder(this.value),this.setInputValue(this.value),order.volume=this.value,this.trigger("place_order::order::updated",order)}})}.call(this),function(){this.PlaceOrderUI=flight.component(function(){return this.attributes({formSel:"form",successSel:".status-success",infoSel:".status-info",dangerSel:".status-danger",priceAlertSel:".hint-price-disadvantage",positionsLabelSel:".hint-positions",priceSel:"input[id$=price]",volumeSel:"input[id$=volume]",totalSel:"input[id$=total]",currentBalanceSel:"span.current-balance",submitButton:":submit"}),this.panelType=function(){switch(this.$node.attr("id")){case"bid_entry":return"bid";case"ask_entry":return"ask"}},this.cleanMsg=function(){return this.select("successSel").text(""),this.select("infoSel").text(""),this.select("dangerSel").text("")},this.resetForm=function(){return this.trigger("place_order::reset::price"),this.trigger("place_order::reset::volume"),this.trigger("place_order::reset::total"),this.priceAlertHide()},this.disableSubmit=function(){return this.select("submitButton").addClass("disabled").attr("disabled","disabled")},this.enableSubmit=function(){return this.select("submitButton").removeClass("disabled").removeAttr("disabled")},this.confirmDialogMsg=function(){var confirmType,price,sum,volume;return confirmType=this.select("submitButton").text(),price=this.select("priceSel").val(),volume=this.select("volumeSel").val(),sum=this.select("totalSel").val(),""+gon.i18n.place_order.confirm_submit+' "'+confirmType+'"?\n\n'+gon.i18n.place_order.price+": "+price+"\n"+gon.i18n.place_order.volume+": "+volume+"\n"+gon.i18n.place_order.sum+": "+sum},this.beforeSend=function(event,jqXHR){return this.disableSubmit()},this.handleSuccess=function(event,data){return this.cleanMsg(),this.select("successSel").append(JST["templates/hint_order_success"]({msg:data.message})).show(),this.resetForm(event),window.sfx_success(),this.enableSubmit()},this.handleError=function(event,data){var ef_class,json;return this.cleanMsg(),ef_class="shake shake-constant hover-stop",json=JSON.parse(data.responseText),this.select("dangerSel").append(JST["templates/hint_order_warning"]({msg:json.message})).show().addClass(ef_class).wait(500).removeClass(ef_class),window.sfx_warning(),this.enableSubmit()},this.getBalance=function(){return BigNumber(this.select("currentBalanceSel").data("balance"))},this.getLastPrice=function(){return BigNumber(gon.ticker.last)},this.allIn=function(){switch(this.panelType()){case"ask":return this.trigger("place_order::input::price",{price:this.getLastPrice()}),this.trigger("place_order::input::volume",{volume:this.getBalance()});case"bid":return this.trigger("place_order::input::price",{price:this.getLastPrice()}),this.trigger("place_order::input::total",{total:this.getBalance()})}},this.refreshBalance=function(){var balance,currency,type,_ref;return type=this.panelType(),currency=gon.market[type].currency,balance=(null!=(_ref=gon.accounts[currency])?_ref.balance:void 0)||0,this.select("currentBalanceSel").data("balance",balance),this.select("currentBalanceSel").text(formatter.fix(type,balance)),this.trigger("place_order::balance::change",{balance:BigNumber(balance)}),this.trigger("place_order::max::"+this.usedInput,{max:BigNumber(balance)})},this.updateAvailable=function(event,order){var available,node,type;return type=this.panelType(),node=this.select("currentBalanceSel"),order[this.usedInput]||(order[this.usedInput]=0),available=formatter.fix(type,this.getBalance().minus(order[this.usedInput])),BigNumber(available).equals(0)?this.select("positionsLabelSel").hide().text(gon.i18n.place_order["full_"+type]).fadeIn():this.select("positionsLabelSel").fadeOut().text(""),node.text(available)},this.priceAlertHide=function(){return this.select("priceAlertSel").fadeOut(function(){return $(this).text("")})},this.priceAlertShow=function(event,data){return this.select("priceAlertSel").hide().text(gon.i18n.place_order[data.label]).fadeIn()},this.clear=function(e){return this.resetForm(e),this.trigger("place_order::focus::price")},this.after("initialize",function(){var type;return type=this.panelType(),this.usedInput="ask"===type?"volume":"total",PlaceOrderData.attachTo(this.$node),OrderPriceUI.attachTo(this.select("priceSel"),{form:this.$node,type:type}),OrderVolumeUI.attachTo(this.select("volumeSel"),{form:this.$node,type:type}),OrderTotalUI.attachTo(this.select("totalSel"),{form:this.$node,type:type}),this.on("place_order::price_alert::hide",this.priceAlertHide),this.on("place_order::price_alert::show",this.priceAlertShow),this.on("place_order::order::updated",this.updateAvailable),this.on("place_order::clear",this.clear),this.on(document,"account::update",this.refreshBalance),this.on(this.select("formSel"),"ajax:beforeSend",this.beforeSend),this.on(this.select("formSel"),"ajax:success",this.handleSuccess),this.on(this.select("formSel"),"ajax:error",this.handleError),this.on(this.select("currentBalanceSel"),"click",this.allIn)})})}.call(this),function(){this.PushButton=flight.component(function(){return this.attributes({buttons:".type-toggle button"}),this.setActiveButton=function(event){return this.select("buttons").removeClass("active"),$(event.target).closest("button").addClass("active")},this.after("initialize",function(){return this.on(this.select("buttons"),"click",this.setActiveButton)})})}.call(this),function(){}.call(this),function(){this.SmsAuthVerifyUI=flight.component(function(){return this.countDown=0,this.attributes({phoneNumberInput:"#token_sms_token_phone_number",verifyCodeInput:"#token_sms_token_verify_code",sendCodeButton:"button[value=send_code]"}),this.verifyPhoneNumber=function(event){return this.select("phoneNumberInput").parent().removeClass("has-error"),""===this.select("phoneNumberInput").val()?(this.select("phoneNumberInput").parent().addClass("has-error"),event.preventDefault()):setTimeout(function(_this){return function(){return _this.countDownSendCodeButton()}}(this),0)},this.countDownSendCodeButton=function(){var altName,countDownTimer,origName;return origName=this.select("sendCodeButton").data("orig-name"),altName=this.select("sendCodeButton").data("alt-name"),this.countDown=30,this.select("sendCodeButton").attr("disabled","disabled").addClass("disabled"),(countDownTimer=function(_this){return function(){return setTimeout(function(){return 0!==_this.countDown?(_this.countDown--,_this.select("sendCodeButton").text(altName.replace("COUNT",_this.countDown)),countDownTimer()):_this.select("sendCodeButton").removeAttr("disabled").removeClass("disabled").text(origName)},1e3)}}(this))()},this.beforeSend=function(event,jqXHR,settings){var input;if(!settings.data.match("send_code"))return input=this.select("verifyCodeInput"),input.parent().removeClass("has-error"),""===input.val()?(input.parent().addClass("has-error"),jqXHR.abort()):void 0},this.handleSuccess=function(event,text){var data;return data=JSON.parse(text),data.reload&&window.location.reload(),this.trigger("flash:notice",{msg:data.text})},this.handleError=function(event,jqXHR){var data;return data=JSON.parse(jqXHR.responseText),this.countDown=0,this.trigger("flash:alert",{msg:data.text})},this.after("initialize",function(){return this.on(this.select("sendCodeButton"),"click",this.verifyPhoneNumber),this.on("ajax:beforeSend",this.beforeSend),this.on("ajax:success",this.handleSuccess),this.on("ajax:error",this.handleError)})})}.call(this),function(){this.SwitchUI=flight.component(function(){return this.attributes({"switch":"li > a"}),this.getX=function(){return Cookies.get(this.name())?Cookies.get(this.name()):this.setX(this.defaultX())},this.setX=function(x){return Cookies.set(this.name(),x),x},this.name=function(){return this.$node.attr("id")},this.defaultX=function(){return this.$node.data("x")},this.init=function(){return this.$node.find("[data-x="+this.getX()+"]").click()},this.after("initialize",function(){return this.on(this.select("switch"),"click",function(_this){return function(e){var x;return _this.select("switch").removeClass("active"),$(e.currentTarget).addClass("active"),x=$(e.currentTarget).data("x"),_this.setX(x),_this.trigger("switch::"+_this.name(),{x:x})}}(this)),this.on(document,"switch::"+this.name()+"::init",this.init),this.init()})})}.call(this),function(){this.TwoFactorAuth=flight.component(function(){return this.attributes({switchName:"span.switch-name",switchItem:".dropdown-menu a",switchItemApp:'.dropdown-menu a[data-type="app"]',switchItemSms:'.dropdown-menu a[data-type="sms"]',sendCodeButtonContainer:".send-code-button",sendCodeButton:"button[value=send_code]",authType:".two_factor_auth_type",appHint:"span.hint.app",smsHint:"span.hint.sms",chapterWrap:".captcha-wrap"}),this.setActiveItem=function(event){switch($(event.target).data("type")){case"app":return this.switchToApp();case"sms":return this.switchToSms()}},this.switchToApp=function(){return this.select("switchName").text(this.select("switchItemApp").text()),this.select("sendCodeButtonContainer").addClass("hide"),this.select("authType").val("app"),this.select("smsHint").addClass("hide"),this.select("appHint").removeClass("hide")},this.switchToSms=function(){return this.select("switchName").text(this.select("switchItemSms").text()),this.select("sendCodeButtonContainer").removeClass("hide"),this.select("authType").val("sms"),this.select("smsHint").removeClass("hide"),this.select("appHint").addClass("hide")},this.countDownSendCodeButton=function(){var altName,countDown,countDownTimer,origName;return origName=this.select("sendCodeButton").data("orig-name"),altName=this.select("sendCodeButton").data("alt-name"),countDown=30,this.select("sendCodeButton").attr("disabled","disabled").addClass("disabled"),(countDownTimer=function(_this){return function(){return setTimeout(function(){return 0!==countDown?(countDown--,_this.select("sendCodeButton").text(altName.replace("COUNT",countDown)),countDownTimer()):_this.select("sendCodeButton").removeAttr("disabled").removeClass("disabled").text(origName)},1e3)}}(this))()},this.sendCode=function(event){return event.preventDefault(),this.countDownSendCodeButton(),$.get("/two_factors/sms?refresh=true")},this.checkCaptchaRequired=function(){return this.select("chapterWrap").load("/two_factors/app",function(html){return $(this).html(html)})},this.after("initialize",function(){return this.checkCaptchaRequired(),$.subscribe("withdraw:form:submitted",function(_this){return function(){return _this.checkCaptchaRequired()}}(this)),this.on(this.select("switchItem"),"click",this.setActiveItem),this.on(this.select("sendCodeButton"),"click",this.sendCode)})})}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/flash_message"]=function(__obj){__obj||(__obj={});var __safe,__out=[],__sanitize=function(value){return value&&value.ecoSafe?value:"undefined"!=typeof value&&null!=value?__escape(value):""},__objSafe=__obj.safe,__escape=__obj.escape;return __safe=__obj.safe=function(value){if(value&&value.ecoSafe)return value;("undefined"==typeof value||null==value)&&(value="");var result=new String(value);return result.ecoSafe=!0,result},__escape||(__escape=__obj.escape=function(value){return(""+value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){this.notice&&(__out.push('\n<div class="alert alert-dismissable alert-success" id="notice">\n  <button aria-hidden="true" class="close" data-dismiss="alert" type="button">×</button>\n  <h5><i class="fa fa-bullhorn"></i><span>'),__out.push(__sanitize(this.msg)),__out.push("</span></h5>\n</div>\n")),__out.push("\n"),this.alert&&(__out.push('\n<div class="alert alert-dismissable alert-warning" id="alert">\n  <button aria-hidden="true" class="close" data-dismiss="alert" type="button">×</button>\n  <h5><i class="fa fa-info-circle"></i><span>'),__out.push(__sanitize(this.msg)),__out.push("</span></h5>\n</div>\n")),__out.push("\n"),this.info&&(__out.push('\n<div class="alert alert-dismissable alert-info" id="info">\n  <button aria-hidden="true" class="close" data-dismiss="alert" type="button">×</button>\n  <h5><i class="fa fa-info-circle"></i><span>'),__out.push(__sanitize(this.msg)),__out.push("</span></h5>\n</div>\n")),__out.push("\n")}).call(this)}.call(__obj),__obj.safe=__objSafe,__obj.escape=__escape,__out.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/hint_order_success"]=function(__obj){__obj||(__obj={});var __safe,__out=[],__sanitize=function(value){return value&&value.ecoSafe?value:"undefined"!=typeof value&&null!=value?__escape(value):""},__objSafe=__obj.safe,__escape=__obj.escape;return __safe=__obj.safe=function(value){if(value&&value.ecoSafe)return value;("undefined"==typeof value||null==value)&&(value="");var result=new String(value);return result.ecoSafe=!0,result},__escape||(__escape=__obj.escape=function(value){return(""+value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){__out.push('<i class="fa fa-check text-default">\n  '),__out.push(__sanitize(this.msg)),__out.push("\n</i>\n")}).call(this)}.call(__obj),__obj.safe=__objSafe,__obj.escape=__escape,__out.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/hint_order_warning"]=function(__obj){__obj||(__obj={});var __safe,__out=[],__sanitize=function(value){return value&&value.ecoSafe?value:"undefined"!=typeof value&&null!=value?__escape(value):""},__objSafe=__obj.safe,__escape=__obj.escape;return __safe=__obj.safe=function(value){if(value&&value.ecoSafe)return value;("undefined"==typeof value||null==value)&&(value="");var result=new String(value);return result.ecoSafe=!0,result},__escape||(__escape=__obj.escape=function(value){return(""+value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){__out.push('<i class="fa fa-times text-default">\n  '),__out.push(__sanitize(this.msg)),__out.push("\n</i>\n")}).call(this)}.call(__obj),__obj.safe=__objSafe,__obj.escape=__escape,__out.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/market_trade"]=function(__obj){__obj||(__obj={});var __safe,__out=[],__sanitize=function(value){return value&&value.ecoSafe?value:"undefined"!=typeof value&&null!=value?__escape(value):""},__objSafe=__obj.safe,__escape=__obj.escape;return __safe=__obj.safe=function(value){if(value&&value.ecoSafe)return value;("undefined"==typeof value||null==value)&&(value="");var result=new String(value);return result.ecoSafe=!0,result},__escape||(__escape=__obj.escape=function(value){return(""+value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){var trend;trend=formatter.trend(this.type),__out.push("\n\n<tr id='market-trade-"),__out.push(__sanitize(this.tid)),__out.push("' class='"),__out.push(__sanitize(this.classes)),__out.push('\'>\n  <td class="time text-left col-xs-5"><div>\n    '),__out.push(formatter.trade_time(this.date)),__out.push("\n  </div></td>\n  <td class=\"my text-left col-xs-1\"><div>\n    <i class='fa fa-star'></i>\n  </div></td>\n  <td class='price text-right col-xs-5 "),__out.push(__sanitize(trend)),__out.push("'><div>\n    "),__out.push(formatter.mask_fixed_price(this.price)),__out.push("\n  </div></td>\n  <td class='volume text-right col-xs-5' title='"),__out.push(__sanitize(formatter.fix_bid(this.price*this.amount))),__out.push("'><div>\n    "),__out.push(formatter.mask_fixed_volume(this.amount)),__out.push("\n  </div></td>\n</tr>\n")}).call(this)}.call(__obj),__obj.safe=__objSafe,__obj.escape=__escape,__out.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/my_trade"]=function(__obj){__obj||(__obj={});var __safe,__out=[],__sanitize=function(value){return value&&value.ecoSafe?value:"undefined"!=typeof value&&null!=value?__escape(value):""},__objSafe=__obj.safe,__escape=__obj.escape;return __safe=__obj.safe=function(value){if(value&&value.ecoSafe)return value;("undefined"==typeof value||null==value)&&(value="");var result=new String(value);return result.ecoSafe=!0,result},__escape||(__escape=__obj.escape=function(value){return(""+value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){var trend;trend=formatter.trend(this.kind),__out.push("\n\n<tr class='"),__out.push(__sanitize(this.classes)),__out.push('\'>\n  <td colspan=2 class="time text-left col-xs-8"><div>\n    '),__out.push(formatter.fulltime(this.at)),__out.push("\n  </div></td>\n  <td class='price text-right col-xs-4 "),__out.push(__sanitize(trend)),__out.push("'><div>\n    "),__out.push(formatter.mask_fixed_price(this.price)),__out.push("\n  </div></td>\n  <td class='volume text-right col-xs-4'><div>\n    "),__out.push(formatter.mask_fixed_volume(this.volume)),__out.push("\n  </div></td>\n</tr>\n")}).call(this)}.call(__obj),__obj.safe=__objSafe,__obj.escape=__escape,__out.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/order_active"]=function(__obj){__obj||(__obj={});var __safe,__out=[],__sanitize=function(value){return value&&value.ecoSafe?value:"undefined"!=typeof value&&null!=value?__escape(value):""},__objSafe=__obj.safe,__escape=__obj.escape;return __safe=__obj.safe=function(value){if(value&&value.ecoSafe)return value;("undefined"==typeof value||null==value)&&(value="");var result=new String(value);return result.ecoSafe=!0,result},__escape||(__escape=__obj.escape=function(value){return(""+value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){var trade_state;trade_state=this.origin_volume===this.volume?"new":"partial",__out.push('\n\n<tr data-id="'),__out.push(__sanitize(this.id)),__out.push('" data-kind="'),__out.push(__sanitize(this.kind)),__out.push('" class="order '),__out.push(__sanitize(this.kind)),__out.push("\">\n  <td class='time text-left col-xs-6'>\n    <span>"),__out.push(formatter.fulltime(this.at)),__out.push("</span>\n  </td>\n  <td class='kind text-left col-xs-6'>\n    <span class='label label-"),__out.push(__sanitize(this.kind)),__out.push("'>"),__out.push(__sanitize(formatter.short_trade(this.kind))),__out.push("</span><span class='label label-"),__out.push(__sanitize(trade_state)),__out.push("'>"),__out.push(__sanitize(gon.i18n.trade_state[trade_state])),__out.push("</span>\n  </td>\n  <td class='price text-right col-xs-4 "),__out.push(__sanitize(formatter.trend(this.kind))),__out.push("'>\n    <span>"),__out.push(formatter.mask_fixed_price(this.price)),__out.push("</span>\n  </td>\n  <td class='volume text-right col-xs-4'>\n    <span>"),__out.push(formatter.mask_fixed_volume(this.volume)),__out.push("</span>\n  </td>\n  <td class='amount text-right col-xs-5'>\n    <span>"),__out.push(formatter.amount(this.volume,this.price)),__out.push("</span>\n  </td>\n</tr>\n")}).call(this)}.call(__obj),__obj.safe=__objSafe,__obj.escape=__escape,__out.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/order_book_ask"]=function(__obj){__obj||(__obj={});var __safe,__out=[],__sanitize=function(value){return value&&value.ecoSafe?value:"undefined"!=typeof value&&null!=value?__escape(value):""},__objSafe=__obj.safe,__escape=__obj.escape;return __safe=__obj.safe=function(value){if(value&&value.ecoSafe)return value;("undefined"==typeof value||null==value)&&(value="");var result=new String(value);return result.ecoSafe=!0,result},__escape||(__escape=__obj.escape=function(value){return(""+value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){__out.push("<tr data-order='"),__out.push(__sanitize(this.index)),__out.push("' data-price='"),__out.push(__sanitize(this.price)),__out.push("' data-volume='"),__out.push(__sanitize(this.volume)),__out.push("' class='"),__out.push(__sanitize(this.classes)),__out.push("'>\n  <td class='price col-xs-7 text-down'><div>\n    "),__out.push(formatter.mask_fixed_price(this.price)),__out.push("\n  </div></td>\n  <td class='volume col-xs-7'><div>\n    "),__out.push(formatter.mask_fixed_volume(this.volume)),__out.push("\n  </div></td>\n  <td class='amount col-xs-10'><div>\n    "),__out.push(formatter.amount(this.volume,this.price)),__out.push("\n  </div></td>\n</tr>\n")}).call(this)}.call(__obj),__obj.safe=__objSafe,__obj.escape=__escape,__out.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/order_book_bid"]=function(__obj){__obj||(__obj={});var __safe,__out=[],__sanitize=function(value){return value&&value.ecoSafe?value:"undefined"!=typeof value&&null!=value?__escape(value):""},__objSafe=__obj.safe,__escape=__obj.escape;return __safe=__obj.safe=function(value){if(value&&value.ecoSafe)return value;("undefined"==typeof value||null==value)&&(value="");var result=new String(value);return result.ecoSafe=!0,result},__escape||(__escape=__obj.escape=function(value){return(""+value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){__out.push("<tr data-order='"),__out.push(__sanitize(this.index)),__out.push("' data-price='"),__out.push(__sanitize(this.price)),__out.push("' data-volume='"),__out.push(__sanitize(this.volume)),__out.push("' class='"),__out.push(__sanitize(this.classes)),__out.push("'>\n  <td class='amount col-xs-10'><div>\n    "),__out.push(formatter.amount(this.volume,this.price)),__out.push("\n  </div></td>\n  <td class='volume col-xs-7'><div>\n    "),__out.push(formatter.mask_fixed_volume(this.volume)),__out.push("\n  </div></td>\n  <td class='price col-xs-7 text-up'><div>\n    "),__out.push(formatter.mask_fixed_price(this.price)),__out.push("\n  </div></td>\n</tr>\n")}).call(this)}.call(__obj),__obj.safe=__objSafe,__obj.escape=__escape,__out.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/order_done"]=function(__obj){__obj||(__obj={});var __safe,__out=[],__sanitize=function(value){return value&&value.ecoSafe?value:"undefined"!=typeof value&&null!=value?__escape(value):""},__objSafe=__obj.safe,__escape=__obj.escape;return __safe=__obj.safe=function(value){if(value&&value.ecoSafe)return value;("undefined"==typeof value||null==value)&&(value="");var result=new String(value);return result.ecoSafe=!0,result},__escape||(__escape=__obj.escape=function(value){return(""+value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){__out.push("<tr data-id='"),__out.push(__sanitize(this.id)),__out.push("' data-kind='"),__out.push(__sanitize(this.kind)),__out.push("' class='order "),__out.push(__sanitize(this.kind)),__out.push("'>\n  <td class='time text-left col-xs-6'>\n    "),__out.push(formatter.fulltime(this.at)),__out.push("\n  </td>\n  <td class='kind text-left col-xs-2 "),__out.push(formatter.trend(this.kind)),__out.push("'>\n    "),__out.push(formatter.short_trade(this.kind)),__out.push("\n  </td>\n  <td class='price text-right col-xs-4'>\n    "),__out.push(__sanitize(formatter.fix_bid(this.price))),__out.push("\n  </td>\n  <td class='volume text-right col-xs-4'>\n    "),__out.push(__sanitize(formatter.fix_ask(this.volume))),__out.push("\n  </td>\n  <td class='amount text-right col-xs-5'>\n    "),__out.push(formatter.amount(this.volume,this.price)),__out.push("\n  </td>\n  <td class='col-xs-3'></td>\n</tr>\n")}).call(this)}.call(__obj),__obj.safe=__objSafe,__obj.escape=__escape,__out.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/tooltip"]=function(__obj){__obj||(__obj={});var __safe,__out=[],__sanitize=function(value){return value&&value.ecoSafe?value:"undefined"!=typeof value&&null!=value?__escape(value):""},__objSafe=__obj.safe,__escape=__obj.escape;return __safe=__obj.safe=function(value){if(value&&value.ecoSafe)return value;("undefined"==typeof value||null==value)&&(value="");var result=new String(value);return result.ecoSafe=!0,result},__escape||(__escape=__obj.escape=function(value){return(""+value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){__out.push("<div class='chart-ticker'>\n  <span class='tooltip-title'>"),__out.push(__sanitize(this.title)),__out.push("</span>\n\n  <br />\n\n  <div class='tooltip-ticker'>\n    <span class=t-title>"),__out.push(__sanitize(gon.i18n.chart.open)),__out.push("</span>\n    <span class=t-value>"),__out.push(__sanitize(this.format(this.points.candlestick.open,gon.market.bid.fixed))),__out.push("</span>\n  </div>\n  <div class='tooltip-ticker'>\n    <span class=t-title>"),__out.push(__sanitize(gon.i18n.chart.close)),__out.push("</span>\n    <span class=t-value>"),__out.push(__sanitize(this.format(this.points.candlestick.close,gon.market.bid.fixed))),__out.push("</span>\n  </div>\n  <div class='tooltip-ticker'>\n    <span class=t-title>"),__out.push(__sanitize(gon.i18n.chart.high)),__out.push("</span>\n    <span class=t-value>"),__out.push(__sanitize(this.format(this.points.candlestick.high,gon.market.bid.fixed))),__out.push("</span>\n  </div>\n  <div class='tooltip-ticker'>\n    <span class=t-title>"),__out.push(__sanitize(gon.i18n.chart.low)),__out.push("</span>\n    <span class=t-value>"),__out.push(__sanitize(this.format(this.points.candlestick.low,gon.market.bid.fixed))),__out.push("</span>\n  </div>\n  <div class='tooltip-ticker'>\n    <span class=t-title>"),__out.push(__sanitize(gon.i18n.chart.volume)),__out.push("</span>\n    <span class=t-value>"),__out.push(__sanitize(this.format(this.points.volume.y,gon.market.ask.fixed))),__out.push("</span>\n  </div>\n\n  <ul class='list-inline'>\n    "),this.indicator.MA&&(__out.push("\n      <li>\n        <span style='color: "),__out.push(__sanitize(this.points.ma5.series.color)),__out.push(";'>"),__out.push(__sanitize(this.points.ma5.series.name)),__out.push(": <b>"),__out.push(__sanitize(this.format(this.points.ma5.y,gon.market.bid.fixed))),__out.push("</b></span>\n      </li>\n      <li>\n        <span style='color: "),__out.push(__sanitize(this.points.ma10.series.color)),__out.push(";'>"),__out.push(__sanitize(this.points.ma10.series.name)),__out.push(": <b>"),__out.push(__sanitize(this.format(this.points.ma10.y,gon.market.bid.fixed))),__out.push("</b></span>\n      </li>\n    ")),__out.push("\n    "),this.indicator.EMA&&(__out.push("\n      <li>\n        <span style='color: "),__out.push(__sanitize(this.points.ema7.series.color)),__out.push(";'>"),__out.push(__sanitize(this.points.ema7.series.name)),__out.push(": <b>"),__out.push(__sanitize(this.format(this.points.ema7.y,gon.market.bid.fixed))),__out.push("</b></span>\n      </li>\n      <li>\n        <span style='color: "),__out.push(__sanitize(this.points.ema30.series.color)),__out.push(";'>"),__out.push(__sanitize(this.points.ema30.series.name)),__out.push(": <b>"),__out.push(__sanitize(this.format(this.points.ema30.y,gon.market.bid.fixed))),__out.push("</b></span>\n      </li>\n    ")),__out.push("\n    <li>\n      <span style='color: "),__out.push(__sanitize(this.points.macd.series.color)),__out.push(";'>"),__out.push(__sanitize(this.points.macd.series.name)),__out.push(": <b>"),__out.push(__sanitize(this.format(this.points.macd.y))),__out.push("</b></span>\n    </li>\n    <li>\n      <span style='color: "),__out.push(__sanitize(this.points.sig.series.color)),__out.push(";'>"),__out.push(__sanitize(this.points.sig.series.name)),__out.push(": <b>"),__out.push(__sanitize(this.format(this.points.sig.y))),__out.push("</b></span>\n    </li>\n    <li>\n      <span style='color: "),__out.push(__sanitize(this.points.hist.series.color)),__out.push(";'>"),__out.push(__sanitize(this.points.hist.series.name)),__out.push(": <b>"),__out.push(__sanitize(this.format(this.points.hist.y))),__out.push("</b></span>\n    </li>\n  </ul>\n\n</div>\n")}).call(this)}.call(__obj),__obj.safe=__objSafe,__obj.escape=__escape,__out.join("")}}.call(this),function(){$(function(){return window.notifier=new Notifier,BigNumber.config({ERRORS:!1}),HeaderUI.attachTo("header"),AccountSummaryUI.attachTo("#account_summary"),FloatUI.attachTo(".float"),KeyBindUI.attachTo(document),AutoWindowUI.attachTo(window),PlaceOrderUI.attachTo("#bid_entry"),PlaceOrderUI.attachTo("#ask_entry"),OrderBookUI.attachTo("#order_book"),DepthUI.attachTo("#depths_wrapper"),MyOrdersUI.attachTo("#my_orders"),MarketTickerUI.attachTo("#ticker"),MarketSwitchUI.attachTo("#market_list_wrapper"),MarketTradesUI.attachTo("#market_trades_wrapper"),MarketData.attachTo(document),GlobalData.attachTo(document,{pusher:window.pusher}),gon.accounts&&MemberData.attachTo(document,{pusher:window.pusher}),CandlestickUI.attachTo("#candlestick"),SwitchUI.attachTo("#range_switch, #indicator_switch, #main_indicator_switch, #type_switch"),$(".panel-body-content").niceScroll({autohidemode:!0,cursorborder:"none"})})}.call(this);
public/assets/funds-7252578de957fa4f860a9d88b2e99187.js:}),la=_.last(asks),lb=_.last(bids),la&&lb?(mid=(_.first(bids)[0]+_.first(asks)[0])/2,offset=Math.min.apply(Math,[Math.max(.1*mid,1),.8*(mid-lb[0]),.8*(la[0]-mid)])):null==la&&lb?(mid=_.first(bids)[0],offset=Math.min.apply(Math,[Math.max(.1*mid,1),.8*(mid-lb[0])])):la&&null==lb&&(mid=_.first(asks)[0],offset=Math.min.apply(Math,[Math.max(.1*mid,1),.8*(la[0]-mid)])),this.trigger("market::depth::response",{asks:asks,bids:bids,high:mid+offset,low:mid-offset})},this.refreshTicker=function(data){var buy,last,last_buy,last_last,last_sell,market,sell,ticker,tickers;if(!this.last_tickers){for(market in data)ticker=data[market],data[market].buy_trend=data[market].sell_trend=data[market].last_trend=!0;this.last_tickers=data}return tickers=function(){var _results;_results=[];for(market in data)ticker=data[market],buy=parseFloat(ticker.buy),sell=parseFloat(ticker.sell),last=parseFloat(ticker.last),last_buy=parseFloat(this.last_tickers[market].buy),last_sell=parseFloat(this.last_tickers[market].sell),last_last=parseFloat(this.last_tickers[market].last),buy!==last_buy?data[market].buy_trend=ticker.buy_trend=buy>last_buy:ticker.buy_trend=this.last_tickers[market].buy_trend,sell!==last_sell?data[market].sell_trend=ticker.sell_trend=sell>last_sell:ticker.sell_trend=this.last_tickers[market].sell_trend,last!==last_last?data[market].last_trend=ticker.last_trend=last>last_last:ticker.last_trend=this.last_tickers[market].last_trend,market===gon.market.id&&this.trigger("market::ticker",ticker),_results.push({market:market,data:ticker});return _results}.call(this),this.trigger("market::tickers",{tickers:tickers,raw:data}),this.last_tickers=data},this.after("initialize",function(){var global_channel,market_channel;return this.on(document,"market::ticker",this.refreshDocumentTitle),global_channel=this.attr.pusher.subscribe("market-global"),market_channel=this.attr.pusher.subscribe("market-"+gon.market.id+"-global"),global_channel.bind("tickers",function(_this){return function(data){return _this.refreshTicker(data)}}(this)),market_channel.bind("update",function(_this){return function(data){return gon.asks=data.asks,gon.bids=data.bids,_this.trigger("market::order_book::update",{asks:data.asks,bids:data.bids}),_this.refreshDepth({asks:data.asks,bids:data.bids})}}(this)),market_channel.bind("trades",function(_this){return function(data){return _this.trigger("market::trades",{trades:data.trades})}}(this)),gon.ticker&&this.trigger("market::ticker",gon.ticker),gon.tickers&&this.refreshTicker(gon.tickers),gon.asks&&gon.bids&&(this.trigger("market::order_book::update",{asks:gon.asks,bids:gon.bids}),this.refreshDepth({asks:gon.asks,bids:gon.bids})),gon.trades?this.trigger("market::trades",{trades:gon.trades.reverse()}):void 0})})}.call(this),function(){this.MarketData=flight.component(function(){return this.load=function(event,data){return this.trigger("market::candlestick::request"),this.reqK(gon.market.id,data.x)},this.reqK=function(market,minutes,limit){var tid,url;return null==limit&&(limit=768),tid=gon.trades.length>0?gon.trades[0].tid:0,this.last_tid&&(tid=this.last_tid+1),url="/api/v2/k_with_pending_trades.json?market="+market+"&limit="+limit+"&period="+minutes+"&trade_id="+tid,$.getJSON(url,function(_this){return function(data){return _this.handleData(data,minutes)}}(this))},this.checkTrend=function(pre,cur){var cur_close,pre_close,_;return _=cur[0],_=cur[1],_=cur[2],_=cur[3],cur_close=cur[4],_=cur[5],_=pre[0],_=pre[1],_=pre[2],_=pre[3],pre_close=pre[4],_=pre[5],cur_close>=pre_close},this.createPoint=function(i,trade){var gap,p,v,x,_ref;if(gap=Math.floor((trade.date-this.next_ts)/(60*this.minutes)),gap>100)return console.log("failed to update, too wide gap."),window.clearInterval(this.interval),this.trigger("market::candlestick::request"),i;for(;trade.date>=this.next_ts;)x=1e3*this.next_ts,this.last_ts=this.next_ts,this.next_ts=this.last_ts+60*this.minutes,_ref=trade.date<this.next_ts?[parseFloat(trade.price),parseFloat(trade.amount)]:[this.points.close[i][1],0],p=_ref[0],v=_ref[1],this.points.close.push([x,p]),this.points.candlestick.push([x,p,p,p,p]),this.points.volume.push({x:x,y:v,color:p>=this.points.close[i][1]?"rgba(0, 255, 0, 0.5)":"rgba(255, 0, 0, 0.5)"}),i+=1;return i},this.updatePoint=function(i,trade){var p,v;return p=parseFloat(trade.price),v=parseFloat(trade.amount),this.points.close[i][1]=p,p>this.points.candlestick[i][2]?this.points.candlestick[i][2]=p:p<this.points.candlestick[i][3]&&(this.points.candlestick[i][3]=p),this.points.candlestick[i][4]=p,this.points.volume[i].y+=v,this.points.volume[i].color=i>0&&this.points.close[i][1]>=this.points.close[i-1][1]?"rgba(0, 255, 0, 0.5)":"rgba(255, 0, 0, 0.5)"},this.refreshUpdatedAt=function(){return this.updated_at=Math.round((new Date).valueOf()/1e3)},this.processTrades=function(){var i;return i=this.points.candlestick.length-1,$.each(this.tradesCache,function(_this){return function(ti,trade){return trade.tid>_this.last_tid?(_this.last_ts<=trade.date&&trade.date<_this.next_ts?_this.updatePoint(i,trade):_this.next_ts<=trade.date&&(i=_this.createPoint(i,trade)),_this.last_tid=trade.tid,_this.refreshUpdatedAt()):void 0}}(this)),this.tradesCache=[]},this.prepare=function(k){var candlestick,close,close_price,cur,high,i,low,open,time,trend,vol,volume,_i,_len,_ref;for(_ref=[[],[],[]],volume=_ref[0],candlestick=_ref[1],close_price=_ref[2],i=_i=0,_len=k.length;_len>_i;i=++_i)cur=k[i],time=cur[0],open=cur[1],high=cur[2],low=cur[3],close=cur[4],vol=cur[5],time=1e3*time,trend=i>=1?this.checkTrend(k[i-1],cur):!0,close_price.push([time,close]),candlestick.push([time,open,high,low,close]),volume.push({x:time,y:vol,color:trend?"rgba(0, 255, 0, 0.5)":"rgba(255, 0, 0, 0.5)"});return{minutes:this.minutes,candlestick:candlestick.slice(0,-1),volume:volume.slice(0,-1),close:close_price.slice(0,-1)}},this.handleData=function(data,minutes){return this.minutes=minutes,this.tradesCache=data.trades.concat(this.tradesCache),this.points=this.prepare(data.k),this.last_tid=0,this.last_ts=this.points.candlestick.length>0?this.points.candlestick[this.points.candlestick.length-1][0]/1e3:0,this.next_ts=this.last_ts+60*minutes,this.deliverTrades("market::candlestick::response")},this.deliverTrades=function(event){return this.processTrades(),this.trigger(event,{minutes:this.points.minutes,candlestick:this.points.candlestick.slice(1),close:this.points.close.slice(1),volume:this.points.volume.slice(1)}),this.points.close=this.points.close.slice(-2),this.points.candlestick=this.points.candlestick.slice(-2),this.points.volume=this.points.volume.slice(-2)},this.hardRefresh=function(threshold){var ts;return ts=Math.round((new Date).valueOf()/1e3),ts>this.updated_at+threshold?(this.refreshUpdatedAt(),this.reqK(gon.market.id,this.minutes)):void 0},this.startDeliver=function(){var deliver;return null!=this.interval&&window.clearInterval(this.interval),deliver=function(_this){return function(){return _this.tradesCache.length>0?_this.deliverTrades("market::candlestick::trades"):_this.hardRefresh(300)}}(this),this.interval=setInterval(deliver,999)},this.cacheTrades=function(event,data){return this.tradesCache=Array.prototype.concat(this.tradesCache,data.trades)},this.after("initialize",function(){return this.tradesCache=[],this.on(document,"market::trades",this.cacheTrades),this.on(document,"switch::range_switch",this.load),this.on(document,"market::candlestick::created",this.startDeliver)})})}.call(this),function(){this.MemberData=flight.component(function(){return this.after("initialize",function(){var channel;if(gon.current_user)return channel=this.attr.pusher.subscribe("private-"+gon.current_user.sn),channel.bind("account",function(_this){return function(data){return gon.accounts[data.currency]=data,_this.trigger("account::update",gon.accounts)}}(this)),channel.bind("order",function(_this){return function(data){return _this.trigger("order::"+data.state,data)}}(this)),channel.bind("trade",function(_this){return function(data){return _this.trigger("trade",data)}}(this)),this.trigger("account::update",gon.accounts),gon.my_orders&&this.trigger("order::wait::populate",{orders:gon.my_orders}),gon.my_trades?this.trigger("trade::populate",{trades:gon.my_trades}):void 0})})}.call(this),function(){this.PlaceOrderData=flight.component(function(){return this.onInput=function(event,data){var _ref;return _ref=data.variables,this.input=_ref.input,this.known=_ref.known,this.output=_ref.output,this.order[this.input]=data.value,this.order[this.input]&&this.order[this.known]?this.trigger("place_order::output::"+this.output,this.order):void 0},this.onReset=function(event,data){var _ref;return _ref=data.variables,this.input=_ref.input,this.known=_ref.known,this.output=_ref.output,this.order[this.input]=this.order[this.output]=null,this.trigger("place_order::reset::"+this.output),this.trigger("place_order::order::updated",this.order)},this.after("initialize",function(){return this.order={price:null,volume:null,total:null},this.on("place_order::input",this.onInput),this.on("place_order::reset",this.onReset)})})}.call(this),function(){this.AccountBalanceUI=flight.component(function(){return this.updateAccount=function(event,data){var account,currency,symbol,total,_results;_results=[];for(currency in data)account=data[currency],symbol=gon.currencies[currency].symbol||"",this.$node.find(".account."+currency+" span.balance").text(""+account.balance),this.$node.find(".account."+currency+" span.locked").text(""+account.locked),total=new BigNumber(account.locked).plus(new BigNumber(account.balance)),_results.push(this.$node.find(".account."+currency+" span.total").text(""+symbol+formatter.round(total,2)));return _results},this.updateTotalAssets=function(event,data){var account,currency,fiatCurrency,sum,symbol,ticker;fiatCurrency=gon.fiat_currency,symbol=gon.currencies[fiatCurrency].symbol,sum=0;for(currency in data)account=data[currency],currency===fiatCurrency?(sum+=+account.balance,sum+=+account.locked):(ticker=gon.tickers[""+currency+fiatCurrency])&&(sum+=+account.balance*+ticker.last,sum+=+account.locked*+ticker.last);return this.$node.find(".total-assets").text(" ≈ "+symbol+" "+formatter.round(sum,2))},this.after("initialize",function(){return this.on(document,"account::update",this.updateAccount),this.on(document,"account::update",this.updateTotalAssets)})})}.call(this),function(){this.AccountSummaryUI=flight.component(function(){return this.attributes({total_assets:"#total_assets"}),this.updateAccount=function(event,data){var account,amount,currency,_results;_results=[];for(currency in data)account=data[currency],amount=new BigNumber(account.locked).plus(new BigNumber(account.balance)),this.$node.find("tr."+currency+" span.amount").text(formatter.round(amount,2)),_results.push(this.$node.find("tr."+currency+" span.locked").text(formatter.round(account.locked,2)));return _results},this.updateTotalAssets=function(){var account,currency,fiatCurrency,sum,symbol,ticker,_ref;fiatCurrency=gon.fiat_currency,symbol=gon.currencies[fiatCurrency].symbol,sum=0,_ref=this.accounts;for(currency in _ref)account=_ref[currency],currency===fiatCurrency?(sum+=+account.balance,sum+=+account.locked):(ticker=this.tickers[""+currency+fiatCurrency])&&(sum+=+account.balance*+ticker.last,sum+=+account.locked*+ticker.last);return this.select("total_assets").text(""+symbol+formatter.round(sum,2))},this.after("initialize",function(){return this.accounts=gon.accounts,this.tickers=gon.tickers,this.on(document,"account::update",this.updateAccount),this.on(document,"account::update",function(_this){return function(event,data){return _this.accounts=data,_this.updateTotalAssets()}}(this)),this.on(document,"market::tickers",function(_this){return function(event,data){return _this.tickers=data.raw,_this.updateTotalAssets()}}(this))})})}.call(this),function(){var BORDER_WIDTH,GUTTER,PANEL_PADDING,PANEL_TABLE_HEADER_HIGH;GUTTER=2,PANEL_TABLE_HEADER_HIGH=37,PANEL_PADDING=8,BORDER_WIDTH=1,this.AutoWindowUI=flight.component(function(){return this.after("initialize",function(){var gutter,gutter_2x,gutter_3x,gutter_4x,gutter_5x,gutter_6x,gutter_7x,gutter_8x,gutter_9x,panel_table_header_high;return gutter=GUTTER,gutter_2x=2*GUTTER,gutter_3x=3*GUTTER,gutter_4x=4*GUTTER,gutter_5x=5*GUTTER,gutter_6x=6*GUTTER,gutter_7x=7*GUTTER,gutter_8x=8*GUTTER,gutter_9x=9*GUTTER,panel_table_header_high=PANEL_TABLE_HEADER_HIGH,this.$node.resize(function(){var depths_h,entry_h,markets_h,markets_w,my_orders_h,navbar_h,order_book_w,order_h,ticker_h,trades_h,window_h,window_w;return navbar_h=$(".navbar").height()+BORDER_WIDTH,markets_h=$("#market_list").height()+BORDER_WIDTH,entry_h=$("#ask_entry").height()+2*BORDER_WIDTH,depths_h=$("#depths_wrapper").height()+2*BORDER_WIDTH,my_orders_h=$("#my_orders").height()+2*BORDER_WIDTH,ticker_h=$("#ticker").height()+2*BORDER_WIDTH,window_h=$(this).height(),$(".content").height(window_h-navbar_h),$("#candlestick").height(window_h-navbar_h-gutter_3x),order_h=window_h-navbar_h-entry_h-depths_h-my_orders_h-ticker_h-gutter_6x-2*BORDER_WIDTH,$("#order_book").height(order_h),$("#order_book .panel-body-content").height(order_h-panel_table_header_high-2*PANEL_PADDING),trades_h=window_h-navbar_h-markets_h-gutter_3x-BORDER_WIDTH,$("#market_trades").height(trades_h),$("#market_trades .panel").height(trades_h-2*BORDER_WIDTH),$("#market_trades .panel-body-content").height(trades_h-2*BORDER_WIDTH-panel_table_header_high-2*PANEL_PADDING),window_w=window.innerWidth,markets_w=$("#market_list").width(),order_book_w=$("#order_book").width(),$("#candlestick").width(window_w-order_book_w-markets_w-gutter_4x-20)}),this.$node.resize()})})}.call(this),function(){var COLOR,COLOR_OFF,COLOR_ON,DATETIME_LABEL_FORMAT,DATETIME_LABEL_FORMAT_FOR_TOOLTIP,INDICATOR,RANGE_DEFAULT;"zh-CN"===gon.local&&(DATETIME_LABEL_FORMAT_FOR_TOOLTIP={millisecond:["%m月%e日, %H:%M:%S.%L","%m月%e日, %H:%M:%S.%L","-%H:%M:%S.%L"],second:["%m月%e日, %H:%M:%S","%m月%e日, %H:%M:%S","-%H:%M:%S"],minute:["%m月%e日, %H:%M","%m月%e日, %H:%M","-%H:%M"],hour:["%m月%e日, %H:%M","%m月%e日, %H:%M","-%H:%M"],day:["%m月%e日, %H:%M","%m月%e日, %H:%M","-%H:%M"],week:["%Y年%m月%e日","%Y年%m月%e日","-%m月%e日"],month:["%Y年%m月","%Y年%m月","-%m"],year:["%Y","%Y","-%Y"]}),DATETIME_LABEL_FORMAT={second:"%H:%M:%S",minute:"%H:%M",hour:"%H:%M",day:"%m-%d",week:"%m-%d",month:"%Y-%m",year:"%Y"},RANGE_DEFAULT={fill:"none",stroke:"none","stroke-width":0,r:8,style:{color:"#333"},states:{hover:{fill:"#000",style:{color:"#ccc"}},select:{fill:"#000",style:{color:"#eee"}}}},COLOR_ON={candlestick:{color:"#990f0f",upColor:"#000000",lineColor:"#cc1414",upLineColor:"#49c043"},close:{color:null}},COLOR_OFF={candlestick:{color:"invalid",upColor:"invalid",lineColor:"invalid",upLineColor:"invalid"},close:{color:"invalid"}},COLOR={candlestick:_.extend({},COLOR_OFF.candlestick),close:_.extend({},COLOR_OFF.close)},INDICATOR={MA:!1,EMA:!1},this.CandlestickUI=flight.component(function(){return this.mask=function(){return this.$node.find(".mask").show()},this.unmask=function(){return this.$node.find(".mask").hide()},this.request=function(){return this.mask()},this.init=function(event,data){var _ref;return this.running=!0,null!=(_ref=this.$node.find("#candlestick_chart").highcharts())&&_ref.destroy(),this.initHighStock(data),this.trigger("market::candlestick::created",data)},this.switchType=function(event,data){var chart,colors,key,s,type,val,_i,_len,_ref;for(key in COLOR)val=COLOR[key],_.extend(COLOR[key],COLOR_OFF[key]);if(_.extend(COLOR[data.x],COLOR_ON[data.x]),chart=this.$node.find("#candlestick_chart").highcharts()){for(type in COLOR)for(colors=COLOR[type],_ref=chart.series,_i=0,_len=_ref.length;_len>_i;_i++)s=_ref[_i],null==s.userOptions.algorithm&&s.userOptions.id===type&&s.update(colors,!1);return this.trigger("switch::main_indicator_switch::init")}},this.switchMainIndicator=function(event,data){var chart,indicator,key,s,val,visible,_i,_j,_len,_len1,_ref,_ref1;for(key in INDICATOR)val=INDICATOR[key],INDICATOR[key]=!1;if(INDICATOR[data.x]=!0,chart=this.$node.find("#candlestick_chart").highcharts()){for(_ref=chart.series,_i=0,_len=_ref.length;_len>_i;_i++)s=_ref[_i],"close"===s.userOptions.linkedTo&&s.setVisible(!0,!1);for(indicator in INDICATOR)for(visible=INDICATOR[indicator],_ref1=chart.series,_j=0,_len1=_ref1.length;_len1>_j;_j++)s=_ref1[_j],null!=s.userOptions.algorithm&&s.userOptions.algorithm===indicator&&s.setVisible(visible,!1);return chart.redraw()}},this.default_range=function(unit){return 6e4*unit*100},this.initHighStock=function(data){var component,dataGrouping,range,timeUnits,title,tooltipTemplate,unit;return component=this,range=this.default_range(data.minutes),unit=$("[data-unit="+data.minutes+"]").text(),title=""+gon.market.base_unit.toUpperCase()+"/"+gon.market.quote_unit.toUpperCase()+" - "+unit,timeUnits={millisecond:1,second:1e3,minute:6e4,hour:36e5,day:864e5,week:6048e5,month:26784e5,year:31556952e3},dataGrouping={enabled:!1},tooltipTemplate=JST["templates/tooltip"],DATETIME_LABEL_FORMAT_FOR_TOOLTIP&&(dataGrouping.dateTimeLabelFormats=DATETIME_LABEL_FORMAT_FOR_TOOLTIP),this.$node.find("#candlestick_chart").highcharts("StockChart",{chart:{events:{load:function(_this){return function(){return _this.unmask()}}(this)},animation:!0,marginTop:95,backgroundColor:"rgba(0,0,0, 0.0)"},credits:{enabled:!1},tooltip:{crosshairs:[{width:.5,dashStyle:"solid",color:"#777"},!1],valueDecimals:gon.market.bid.fixed,borderWidth:0,backgroundColor:"rgba(0,0,0,0)",borderRadius:2,shadow:!1,shared:!0,positioner:function(w,h,point){var chart_h,chart_w,grid_h,x,y;return chart_w=$(this.chart.renderTo).width(),chart_h=$(this.chart.renderTo).height(),grid_h=Math.min(20,Math.ceil(chart_h/10)),x=Math.max(10,point.plotX-w-20),y=Math.max(0,Math.floor(point.plotY/grid_h)*grid_h-20),{x:x,y:y}},useHTML:!0,formatter:function(){var chart,dateFormat,dateTimeLabelFormats,fun,index,k,key,series,v;chart=this.points[0].series.chart,series=this.points[0].series,index=this.points[0].point.index,key=this.points[0].key;for(k in timeUnits)if(v=timeUnits[k],v>=series.xAxis.closestPointRange||v<=timeUnits.day&&key%v>0){dateFormat=dateTimeLabelFormats=series.options.dataGrouping.dateTimeLabelFormats[k][0],title=Highcharts.dateFormat(dateFormat,key);break}return fun=function(h,s){return h[s.options.id]=s.data[index],h},tooltipTemplate({title:title,indicator:INDICATOR,format:function(v,fixed){return null==fixed&&(fixed=3),Highcharts.numberFormat(v,fixed)},points:_.reduce(chart.series,fun,{})})}},plotOptions:{candlestick:{turboThreshold:0,followPointer:!0,color:"#990f0f",upColor:"#000000",lineColor:"#cc1414",upLineColor:"#49c043",dataGrouping:dataGrouping},column:{turboThreshold:0,dataGrouping:dataGrouping},trendline:{lineWidth:1},histogram:{lineWidth:1,tooltip:{pointFormat:"<li><span style='color: {series.color};'>{series.name}: <b>{point.y}</b></span></li>"}}},scrollbar:{buttonArrowColor:"#333",barBackgroundColor:"#202020",buttonBackgroundColor:"#202020",trackBackgroundColor:"#202020",barBorderColor:"#2a2a2a",buttonBorderColor:"#2a2a2a",trackBorderColor:"#2a2a2a"},rangeSelector:{enabled:!1},navigator:{maskFill:"rgba(32, 32, 32, 0.6)",outlineColor:"#333",outlineWidth:1,xAxis:{dateTimeLabelFormats:DATETIME_LABEL_FORMAT}},xAxis:{type:"datetime",dateTimeLabelFormats:DATETIME_LABEL_FORMAT,lineColor:"#333",tickColor:"#333",tickWidth:2,range:range,events:{afterSetExtremes:function(e){return"navigator"===e.trigger&&"navigator-drag"===e.triggerOp&&component.liveRange(this.chart)&&!component.running?component.trigger("switch::range_switch::init"):void 0}}},yAxis:[{labels:{enabled:!0,align:"right",x:2,y:3,zIndex:-7},gridLineColor:"#222",gridLineDashStyle:"ShortDot",top:"0%",height:"70%",lineColor:"#fff",minRange:gon.ticker.last?parseFloat(gon.ticker.last)/25:null},{labels:{enabled:!1},top:"70%",gridLineColor:"#000",height:"15%"},{labels:{enabled:!1},top:"85%",gridLineColor:"#000",height:"15%"}],series:[_.extend({id:"candlestick",name:gon.i18n.chart.candlestick,type:"candlestick",data:data.candlestick,showInLegend:!1},COLOR.candlestick),_.extend({id:"close",type:"spline",data:data.close,showInLegend:!1,marker:{radius:0}},COLOR.close),{id:"volume",name:gon.i18n.chart.volume,yAxis:1,type:"column",data:data.volume,color:"#777",showInLegend:!1},{id:"ma5",name:"MA5",linkedTo:"close",showInLegend:!0,type:"trendline",algorithm:"MA",periods:5,color:"#7c9aaa",visible:INDICATOR.MA,marker:{radius:0}},{id:"ma10",name:"MA10",linkedTo:"close",showInLegend:!0,type:"trendline",algorithm:"MA",periods:10,color:"#be8f53",visible:INDICATOR.MA,marker:{radius:0}},{id:"ema7",name:"EMA7",linkedTo:"close",showInLegend:!0,type:"trendline",algorithm:"EMA",periods:7,color:"#7c9aaa",visible:INDICATOR.EMA,marker:{radius:0}},{id:"ema30",name:"EMA30",linkedTo:"close",showInLegend:!0,type:"trendline",algorithm:"EMA",periods:30,color:"#be8f53",visible:INDICATOR.EMA,marker:{radius:0}},{id:"macd",name:"MACD",linkedTo:"close",yAxis:2,showInLegend:!0,type:"trendline",algorithm:"MACD",color:"#7c9aaa",marker:{radius:0}},{id:"sig",name:"SIG",linkedTo:"close",yAxis:2,showInLegend:!0,type:"trendline",algorithm:"signalLine",color:"#be8f53",marker:{radius:0}},{id:"hist",name:"HIST",linkedTo:"close",yAxis:2,showInLegend:!0,type:"histogram",color:"#990f0f"}]})},this.formatPointArray=function(point){return{x:point[0],open:point[1],high:point[2],low:point[3],close:point[4]}},this.createPointOnSeries=function(chart,i,px,point){return chart.series[i].addPoint(point,!0,!0)},this.createPoint=function(chart,data,i){return this.createPointOnSeries(chart,0,data.candlestick[i][0],data.candlestick[i]),this.createPointOnSeries(chart,1,data.close[i][0],data.close[i]),this.createPointOnSeries(chart,2,data.volume[i].x,data.volume[i]),chart.redraw(!0)},this.updatePointOnSeries=function(chart,i,px,point){var last;return chart.series[i].points?(last=chart.series[i].points[chart.series[i].points.length-1],px===last.x?last.update(point,!1):console.log("Error update on series "+i+": px="+px+" lastx="+last.x)):void 0},this.updatePoint=function(chart,data,i){return this.updatePointOnSeries(chart,0,data.candlestick[i][0],this.formatPointArray(data.candlestick[i])),this.updatePointOnSeries(chart,1,data.close[i][0],data.close[i][1]),this.updatePointOnSeries(chart,2,data.volume[i].x,data.volume[i]),chart.redraw(!0)},this.process=function(chart,data){var current,current_point,i,_i,_ref,_results;for(_results=[],i=_i=0,_ref=data.candlestick.length-1;_ref>=0?_ref>=_i:_i>=_ref;i=_ref>=0?++_i:--_i)current=chart.series[0].points.length-1,current_point=chart.series[0].points[current],data.candlestick[i][0]>current_point.x?_results.push(this.createPoint(chart,data,i)):_results.push(this.updatePoint(chart,data,i));return _results},this.updateByTrades=function(event,data){var chart;return chart=this.$node.find("#candlestick_chart").highcharts(),this.liveRange(chart)?this.process(chart,data):this.running=!1},this.liveRange=function(chart){var p1,p2;return p1=chart.series[0].points[chart.series[0].points.length-1].x,p2=chart.series[10].points[chart.series[10].points.length-1].x,p1===p2},this.after("initialize",function(){return this.on(document,"market::candlestick::request",this.request),this.on(document,"market::candlestick::response",this.init),this.on(document,"market::candlestick::trades",this.updateByTrades),this.on(document,"switch::main_indicator_switch",this.switchMainIndicator),this.on(document,"switch::type_switch",this.switchType)})})}.call(this),function(){this.DepthUI=flight.component(function(){return this.attributes({chart:"#depths"}),this.refresh=function(event,data){var chart;return chart=this.select("chart").highcharts(),chart.series[0].setData(data.bids.reverse(),!1),chart.series[1].setData(data.asks,!1),chart.xAxis[0].setExtremes(data.low,data.high),chart.redraw()},this.initChart=function(){return this.select("chart").highcharts({chart:{margin:0,height:100,backgroundColor:"rgba(0,0,0,0)"},title:{text:""},credits:{enabled:!1},legend:{enabled:!1},rangeSelector:{enabled:!1},xAxis:{labels:{enabled:!1}},yAxis:{min:0,gridLineColor:"#333",gridLineDashStyle:"ShortDot",title:{text:""},labels:{enabled:!1}},tooltip:{valueDecimals:4,headerFormat:"<table class=depths-table><tr>\n  <th><span>{series.name}</span> "+gon.i18n.chart.price+"</th><th>"+gon.i18n.chart.depth+"</th>\n</tr>",pointFormat:"<tr><td>{point.x}</td><td>{point.y}</td></tr>",footerFormat:"</table>",borderWidth:0,backgroundColor:"rgba(0,0,0,0)",borderRadius:0,shadow:!1,useHTML:!0,shared:!0,positioner:function(){return{x:128,y:28}}},series:[{name:gon.i18n.bid,type:"area",fillColor:"rgba(77, 215, 16, 0.5)",lineColor:"rgb(77, 215, 16)",color:"transparent",animation:{duration:1e3}},{name:gon.i18n.ask,type:"area",animation:{duration:1e3},fillColor:"rgba(208, 0, 23, 0.3)",lineColor:"rgb(208, 0, 23)",color:"transparent"}]})},this.after("initialize",function(){return this.initChart(),this.on(document,"market::depth::response",this.refresh),this.on(document,"market::depth::fade_toggle",function(){return this.$node.fadeToggle()}),this.on(this.select("close"),"click",function(_this){return function(){return _this.trigger("market::depth::fade_toggle")}}(this))})})}.call(this),function(){this.FlashMessageUI=flight.component(function(){return this.showMeg=function(data){var template;return this.$node.html(""),template=JST["templates/flash_message"](data),$(template).prependTo(this.$node)},this.info=function(event,data){return data.info=!0,this.showMeg(data)},this.notice=function(event,data){return data.notice=!0,this.showMeg(data)},this.alert=function(event,data){return data.alert=!0,this.showMeg(data)},this.after("initialize",function(){return this.on(document,"flash:info",this.info),this.on(document,"flash:notice",this.notice),this.on(document,"flash:alert",this.alert)})})}.call(this),function(){this.FloatUI=flight.component(function(){return this.attributes({action:"ul.nav.nav-tabs > li",close:"i.fa.fa-close"}),this.after("initialize",function(){return this.select("action").click(function(_this){return function(e){return _this.select("action").length>1?_this.$node.hasClass("hover")&&$(e.currentTarget).hasClass("active")?_this.select("close").click():_this.$node.addClass("hover"):_this.$node.hasClass("hover")?_this.select("close").click():_this.$node.addClass("hover")}}(this)),this.select("close").click(function(_this){return function(){return _this.$node.removeClass("hover"),_this.select("action").removeClass("active")}}(this))})})}.call(this),function(){this.HeaderUI=flight.component(function(){return this.attributes({vol:"span.vol",amount:"span.amount",high:"span.high",low:"span.low",change:"span.change",sound:'input[name="sound-checkbox"]'}),this.refresh=function(event,ticker){var p1,p2,trend;return this.select("vol").text(""+ticker.volume+" "+gon.market.base_unit.toUpperCase()),this.select("high").text(ticker.high),this.select("low").text(ticker.low),p1=parseFloat(ticker.open),p2=parseFloat(ticker.last),trend=formatter.trend(p2>=p1),this.select("change").html("<span class='"+trend+"'>"+formatter.price_change(p1,p2)+"%</span>")},this.after("initialize",function(){var state,_ref;return this.on(document,"market::ticker",this.refresh),void 0===Cookies.get("sound")&&Cookies.set("sound",!0,30),state=null!=(_ref="true"===Cookies.get("sound"))?_ref:{"true":!1},this.select("sound").bootstrapSwitch({labelText:gon.i18n["switch"].sound,state:state,handleWidth:40,labelWidth:40,onSwitchChange:function(event,state){return Cookies.set("sound",state,30)}}),$("header .dropdown-menu").click(function(e){return e.stopPropagation()})})})}.call(this),function(){var ESC;ESC=27,this.KeyBindUI=flight.component(function(){return this.after("initialize",function(){var entry;return entry="#ask_entry",this.$node.on("keyup",function(e){return e.keyCode===ESC?(entry="#bid_entry"===entry?"#ask_entry":"#bid_entry",$(entry).trigger("place_order::clear")):void 0})})})}.call(this),function(){window.MarketSwitchUI=flight.component(function(){return this.attributes({table:"tbody",marketGroupName:".panel-body-head thead span.name",marketGroupItem:".dropdown-wrapper .dropdown-menu li a",marketsTable:".table.markets"}),this.switchMarketGroup=function(event,item){var name;return item=$(event.target).closest("a"),name=item.data("name"),this.select("marketGroupItem").removeClass("active"),item.addClass("active"),this.select("marketGroupName").text(item.find("span").text()),this.select("marketsTable").attr("class","table table-hover markets "+name)},this.updateMarket=function(select,ticker){var p1,p2,trend;return trend=formatter.trend(ticker.last_trend),select.find("td.price").attr("title",ticker.last).html("<span class='"+trend+"'>"+formatter.ticker_price(ticker.last)+"</span>"),p1=parseFloat(ticker.open),p2=parseFloat(ticker.last),trend=formatter.trend(p2>=p1),select.find("td.change").html("<span class='"+trend+"'>"+formatter.price_change(p1,p2)+"%</span>")},this.refresh=function(event,data){var table,ticker,_i,_len,_ref;for(table=this.select("table"),_ref=data.tickers,_i=0,_len=_ref.length;_len>_i;_i++)ticker=_ref[_i],this.updateMarket(table.find("tr#market-list-"+ticker.market),ticker.data);return table.find("tr#market-list-"+gon.market.id).addClass("highlight")},this.after("initialize",function(){return this.on(document,"market::tickers",this.refresh),this.on(this.select("marketGroupItem"),"click",this.switchMarketGroup),this.select("table").on("click","tr",function(e){return"I"!==e.target.nodeName?window.location.href=window.formatter.market_url($(this).data("market")):void 0}),this.hide_accounts=$("tr.hide"),$(".view_all_accounts").on("click",function(_this){return function(e){var $el;return $el=$(e.currentTarget),_this.hide_accounts.hasClass("hide")?($el.text($el.data("hide-text")),_this.hide_accounts.removeClass("hide")):($el.text($el.data("show-text")),_this.hide_accounts.addClass("hide"))}}(this))})})}.call(this),function(){window.MarketTickerUI=flight.component(function(){return this.attributes({askSelector:".ask .price",bidSelector:".bid .price",lastSelector:".last .price",priceSelector:".price"}),this.updatePrice=function(selector,price,trend){return selector.removeClass("text-up").removeClass("text-down").addClass(formatter.trend(trend)),selector.html(formatter.fixBid(price))},this.refresh=function(event,ticker){return this.updatePrice(this.select("askSelector"),ticker.sell,ticker.sell_trend),this.updatePrice(this.select("bidSelector"),ticker.buy,ticker.buy_trend),this.updatePrice(this.select("lastSelector"),ticker.last,ticker.last_trend)},this.after("initialize",function(){return this.on(document,"market::ticker",this.refresh)})})}.call(this),function(){window.MarketTradesUI=flight.component(function(){return flight.compose.mixin(this,[NotificationMixin]),this.attributes({defaultHeight:156,tradeSelector:"tr",newTradeSelector:"tr.new",allSelector:"a.all",mySelector:"a.my",allTableSelector:"table.all-trades tbody",myTableSelector:"table.my-trades tbody",newMarketTradeContent:"table.all-trades tr.new div",newMyTradeContent:"table.my-trades tr.new div",tradesLimit:80}),this.showAllTrades=function(){return this.select("mySelector").removeClass("active"),this.select("allSelector").addClass("active"),this.select("myTableSelector").hide(),this.select("allTableSelector").show()},this.showMyTrades=function(){return this.select("allSelector").removeClass("active"),this.select("mySelector").addClass("active"),this.select("allTableSelector").hide(),this.select("myTableSelector").show()},this.bufferMarketTrades=function(event,data){return this.marketTrades=this.marketTrades.concat(data.trades)},this.clearMarkers=function(table){return table.find("tr.new").removeClass("new"),table.find("tr").slice(this.attr.tradesLimit).remove()},this.notifyMyTrade=function(trade){var market,message;return market=gon.markets[trade.market],message=gon.i18n.notification.new_trade.replace(/%{kind}/g,gon.i18n[trade.kind]).replace(/%{id}/g,trade.id).replace(/%{price}/g,trade.price).replace(/%{volume}/g,trade.volume).replace(/%{base_unit}/g,market.base_unit.toUpperCase()).replace(/%{quote_unit}/g,market.quote_unit.toUpperCase()),this.notify(message)},this.isMine=function(trade){var t,_i,_len,_ref;if(0===this.myTrades.length)return!1;for(_ref=this.myTrades,_i=0,_len=_ref.length;_len>_i;_i++){if(t=_ref[_i],trade.tid===t.id)return!0;if(trade.tid>t.id)return!1}},this.handleMarketTrades=function(event,data){var el,trade,_i,_len,_ref;for(_ref=data.trades,_i=0,_len=_ref.length;_len>_i;_i++)trade=_ref[_i],this.marketTrades.unshift(trade),trade.classes="new",this.isMine(trade)&&(trade.classes+=" mine"),el=this.select("allTableSelector").prepend(JST["templates/market_trade"](trade));return this.marketTrades=this.marketTrades.slice(0,this.attr.tradesLimit),this.select("newMarketTradeContent").slideDown("slow"),setTimeout(function(_this){return function(){return _this.clearMarkers(_this.select("allTableSelector"))
public/assets/application-89b9c8d2652301fa3c8f31f8e97d0d1f.js:this.linkedParent&&(data=[].concat(this.linkedParent.options.data),this.setData(this.runAlgorithm(),!1)),H.Series.prototype.processData.call(this)},runAlgorithm:function(){var xData=this.linkedParent.xData,yData=this.linkedParent.yData,periods=this.options.periods||100,algorithm=this.options.algorithm||"histogram";return this[algorithm](xData,yData,periods)},histogram:function(xData,yData,periods){return calcMACD(xData,yData,periods)[2]}})}(Highcharts),function(){var Formatter;Formatter=function(){function Formatter(){}return Formatter.prototype.round=function(str,fixed){return BigNumber(str).round(fixed,BigNumber.ROUND_HALF_UP).toF(fixed)},Formatter.prototype.fix=function(type,str){return $.isNumeric(str)||(str="0"),"ask"===type?this.round(str,gon.market.ask.fixed):"bid"===type?this.round(str,gon.market.bid.fixed):void 0},Formatter.prototype.fixAsk=function(str){return this.fix("ask",str)},Formatter.prototype.fixBid=function(str){return this.fix("bid",str)},Formatter.prototype.fixPriceGroup=function(str){return gon.market.price_group_fixed?($.isNumeric(str)||(str="0"),this.round(str,gon.market.price_group_fixed)):this.fixBid(str)},Formatter.prototype.check_trend=function(type){if("up"===type||"buy"===type||"bid"===type||type===!0)return!0;if("down"===type||"sell"===type||(type="ask"))return!1;throw"unknown trend smybol "+type},Formatter.prototype.market=function(base,quote){return""+base.toUpperCase()+"/"+quote.toUpperCase()},Formatter.prototype.market_url=function(market,order_id){return null!=order_id?"/markets/"+market+"/orders/"+order_id:"/markets/"+market},Formatter.prototype.trade=function(ask_or_bid){return gon.i18n[ask_or_bid]},Formatter.prototype.short_trade=function(type){return"buy"===type||"bid"===type?gon.i18n.bid:"sell"===type||(type="ask")?gon.i18n.ask:"n/a"},Formatter.prototype.trade_time=function(timestamp){var m;return m=moment.unix(timestamp),""+m.format("HH:mm")+m.format(":ss")},Formatter.prototype.fulltime=function(timestamp){var m;return m=moment.unix(timestamp),""+m.format("MM/DD HH:mm")},Formatter.prototype.mask_price=function(price){return price.replace(/\..*/,"<g>$&</g>")},Formatter.prototype.mask_fixed_price=function(price){return this.mask_price(this.fixPriceGroup(price))},Formatter.prototype.ticker_fill=["","0","00","000","0000","00000","000000","0000000","00000000"],Formatter.prototype.ticker_price=function(price,fillTo){var fill,left,right,_ref;return null==fillTo&&(fillTo=6),_ref=price.split("."),left=_ref[0],right=_ref[1],(fill=this.ticker_fill[fillTo-right.length])?""+left+".<g>"+right+"</g><span class='fill'>"+fill+"</span>":""+left+".<g>"+right.slice(0,fillTo)+"</g>"},Formatter.prototype.price_change=function(p1,p2){var percent;return percent=p1?this.round(100*(p2-p1)/p1,2):"0.00",""+(p1>p2?"":"+")+percent},Formatter.prototype.long_time=function(timestamp){var m;return m=moment.unix(timestamp),""+m.format("YYYY/MM/DD HH:mm")},Formatter.prototype.mask_fixed_volume=function(volume){return this.fixAsk(volume).replace(/\..*/,"<g>$&</g>")},Formatter.prototype.fix_ask=function(volume){return this.fixAsk(volume)},Formatter.prototype.fix_bid=function(price){return this.fixBid(price)},Formatter.prototype.amount=function(amount,price){var val;return val=new BigNumber(amount).times(new BigNumber(price)),this.fixAsk(val).replace(/\..*/,"<g>$&</g>")},Formatter.prototype.trend=function(type){return this.check_trend(type)?"text-up":"text-down"},Formatter.prototype.trend_icon=function(type){return this.check_trend(type)?"<i class='fa fa-caret-up text-up'></i>":"<i class='fa fa-caret-down text-down'></i>"},Formatter.prototype.t=function(key){return gon.i18n[key]},Formatter}(),window.formatter=new Formatter}.call(this),function(){this.ItemListMixin=function(){return this.attributes({tbody:"table > tbody",empty:".empty-row"}),this.checkEmpty=function(){return 0===this.select("tbody").find("tr.order").length?this.select("empty").fadeIn():this.select("empty").fadeOut()},this.addOrUpdateItem=function(item){var existsItem,template;return template=this.getTemplate(item),existsItem=this.select("tbody").find("tr[data-id="+item.id+"][data-kind="+item.kind+"]"),existsItem.length?existsItem.html(template.html()):template.prependTo(this.select("tbody")).show("slow"),this.checkEmpty()},this.removeItem=function(id){var item;return item=this.select("tbody").find("tr[data-id="+id+"]"),item.hide("slow",function(_this){return function(){return item.remove(),_this.checkEmpty()}}(this))},this.populate=function(event,data){var item,_i,_len,_ref;if(!_.isEmpty(data.orders))for(_ref=data.orders,_i=0,_len=_ref.length;_len>_i;_i++)item=_ref[_i],this.addOrUpdateItem(item);return this.checkEmpty()}}}.call(this),function(){this.NotificationMixin=function(){return this.notify=function(body,title){var notification;return title||(title=gon.i18n.notification.title),notification=notifier.notify(title,body)}}}.call(this),function(){this.OrderInputMixin=function(){return this.attributes({form:null,type:null}),this.reset=function(){return this.text="",this.value=null},this.rollback=function(){return this.$node.val(this.text)},this.parseText=function(){var text,value;switch(text=this.$node.val(),value=BigNumber(text),!1){case text!==this.text:return!1;case""!==text:return this.reset(),this.trigger("place_order::reset",{variables:this.attr.variables}),!1;case!!$.isNumeric(text):return this.rollback(),!1;case!(value.c.length-value.e-1>this.attr.precision):return this.rollback(),!1;default:return this.text=text,this.value=value,!0}},this.roundValueToText=function(v){return v.round(this.attr.precision,BigNumber.ROUND_DOWN).toF(this.attr.precision)},this.setInputValue=function(v){return this.text=null!=v?this.roundValueToText(v):"",this.$node.val(this.text)},this.changeOrder=function(v){return this.trigger("place_order::input",{variables:this.attr.variables,value:v})},this.process=function(){return this.parseText()?this.validateRange(this.value)?this.changeOrder(this.value):this.setInputValue(this.value):void 0},this.validateRange=function(v){return this.max&&v.greaterThan(this.max)?(this.value=this.max,this.changeOrder(this.max),!1):v.lessThan(0)?(this.value=null,!1):(this.value=v,!0)},this.onInput=function(e,data){return this.$node.val(this.roundValueToText(data[this.attr.variables.input])),this.process()},this.onMax=function(e,data){return this.max=data.max},this.onReset=function(){return this.$node.val(""),this.reset()},this.onFocus=function(){return this.$node.focus()},this.after("initialize",function(){return this.orderType=this.attr.type,this.text="",this.value=null,this.on(this.$node,"change paste keyup",this.process),this.on(this.attr.form,"place_order::max::"+this.attr.variables.input,this.onMax),this.on(this.attr.form,"place_order::input::"+this.attr.variables.input,this.onInput),this.on(this.attr.form,"place_order::output::"+this.attr.variables.input,this.onOutput),this.on(this.attr.form,"place_order::reset::"+this.attr.variables.input,this.onReset),this.on(this.attr.form,"place_order::focus::"+this.attr.variables.input,this.onFocus)})}}.call(this),function(){window.GlobalData=flight.component(function(){return this.refreshDocumentTitle=function(event,data){var brand,market,price,symbol;return symbol=gon.currencies[gon.market.bid.currency].symbol,price=data.last,market=[gon.market.ask.currency,gon.market.bid.currency].join("/").toUpperCase(),brand="Peatio Exchange",document.title=""+symbol+price+" "+market+" - "+brand},this.refreshDepth=function(data){var asks,asks_sum,bids,bids_sum,la,lb,mid,offset,_ref;return asks=[],bids=[],_ref=[0,0],bids_sum=_ref[0],asks_sum=_ref[1],_.each(data.asks,function(_arg){var price,volume;return price=_arg[0],volume=_arg[1],0===asks.length||price<100*_.last(asks)[0]?asks.push([parseFloat(price),asks_sum+=parseFloat(volume)]):void 0}),_.each(data.bids,function(_arg){var price,volume;return price=_arg[0],volume=_arg[1],0===bids.length||price>_.last(bids)[0]/100?bids.push([parseFloat(price),bids_sum+=parseFloat(volume)]):void 0}),la=_.last(asks),lb=_.last(bids),la&&lb?(mid=(_.first(bids)[0]+_.first(asks)[0])/2,offset=Math.min.apply(Math,[Math.max(.1*mid,1),.8*(mid-lb[0]),.8*(la[0]-mid)])):null==la&&lb?(mid=_.first(bids)[0],offset=Math.min.apply(Math,[Math.max(.1*mid,1),.8*(mid-lb[0])])):la&&null==lb&&(mid=_.first(asks)[0],offset=Math.min.apply(Math,[Math.max(.1*mid,1),.8*(la[0]-mid)])),this.trigger("market::depth::response",{asks:asks,bids:bids,high:mid+offset,low:mid-offset})},this.refreshTicker=function(data){var buy,last,last_buy,last_last,last_sell,market,sell,ticker,tickers;if(!this.last_tickers){for(market in data)ticker=data[market],data[market].buy_trend=data[market].sell_trend=data[market].last_trend=!0;this.last_tickers=data}return tickers=function(){var _results;_results=[];for(market in data)ticker=data[market],buy=parseFloat(ticker.buy),sell=parseFloat(ticker.sell),last=parseFloat(ticker.last),last_buy=parseFloat(this.last_tickers[market].buy),last_sell=parseFloat(this.last_tickers[market].sell),last_last=parseFloat(this.last_tickers[market].last),buy!==last_buy?data[market].buy_trend=ticker.buy_trend=buy>last_buy:ticker.buy_trend=this.last_tickers[market].buy_trend,sell!==last_sell?data[market].sell_trend=ticker.sell_trend=sell>last_sell:ticker.sell_trend=this.last_tickers[market].sell_trend,last!==last_last?data[market].last_trend=ticker.last_trend=last>last_last:ticker.last_trend=this.last_tickers[market].last_trend,market===gon.market.id&&this.trigger("market::ticker",ticker),_results.push({market:market,data:ticker});return _results}.call(this),this.trigger("market::tickers",{tickers:tickers,raw:data}),this.last_tickers=data},this.after("initialize",function(){var global_channel,market_channel;return this.on(document,"market::ticker",this.refreshDocumentTitle),global_channel=this.attr.pusher.subscribe("market-global"),market_channel=this.attr.pusher.subscribe("market-"+gon.market.id+"-global"),global_channel.bind("tickers",function(_this){return function(data){return _this.refreshTicker(data)}}(this)),market_channel.bind("update",function(_this){return function(data){return gon.asks=data.asks,gon.bids=data.bids,_this.trigger("market::order_book::update",{asks:data.asks,bids:data.bids}),_this.refreshDepth({asks:data.asks,bids:data.bids})}}(this)),market_channel.bind("trades",function(_this){return function(data){return _this.trigger("market::trades",{trades:data.trades})}}(this)),gon.ticker&&this.trigger("market::ticker",gon.ticker),gon.tickers&&this.refreshTicker(gon.tickers),gon.asks&&gon.bids&&(this.trigger("market::order_book::update",{asks:gon.asks,bids:gon.bids}),this.refreshDepth({asks:gon.asks,bids:gon.bids})),gon.trades?this.trigger("market::trades",{trades:gon.trades.reverse()}):void 0})})}.call(this),function(){this.MarketData=flight.component(function(){return this.load=function(event,data){return this.trigger("market::candlestick::request"),this.reqK(gon.market.id,data.x)},this.reqK=function(market,minutes,limit){var tid,url;return null==limit&&(limit=768),tid=gon.trades.length>0?gon.trades[0].tid:0,this.last_tid&&(tid=this.last_tid+1),url="/api/v2/k_with_pending_trades.json?market="+market+"&limit="+limit+"&period="+minutes+"&trade_id="+tid,$.getJSON(url,function(_this){return function(data){return _this.handleData(data,minutes)}}(this))},this.checkTrend=function(pre,cur){var cur_close,pre_close,_;return _=cur[0],_=cur[1],_=cur[2],_=cur[3],cur_close=cur[4],_=cur[5],_=pre[0],_=pre[1],_=pre[2],_=pre[3],pre_close=pre[4],_=pre[5],cur_close>=pre_close},this.createPoint=function(i,trade){var gap,p,v,x,_ref;if(gap=Math.floor((trade.date-this.next_ts)/(60*this.minutes)),gap>100)return console.log("failed to update, too wide gap."),window.clearInterval(this.interval),this.trigger("market::candlestick::request"),i;for(;trade.date>=this.next_ts;)x=1e3*this.next_ts,this.last_ts=this.next_ts,this.next_ts=this.last_ts+60*this.minutes,_ref=trade.date<this.next_ts?[parseFloat(trade.price),parseFloat(trade.amount)]:[this.points.close[i][1],0],p=_ref[0],v=_ref[1],this.points.close.push([x,p]),this.points.candlestick.push([x,p,p,p,p]),this.points.volume.push({x:x,y:v,color:p>=this.points.close[i][1]?"rgba(0, 255, 0, 0.5)":"rgba(255, 0, 0, 0.5)"}),i+=1;return i},this.updatePoint=function(i,trade){var p,v;return p=parseFloat(trade.price),v=parseFloat(trade.amount),this.points.close[i][1]=p,p>this.points.candlestick[i][2]?this.points.candlestick[i][2]=p:p<this.points.candlestick[i][3]&&(this.points.candlestick[i][3]=p),this.points.candlestick[i][4]=p,this.points.volume[i].y+=v,this.points.volume[i].color=i>0&&this.points.close[i][1]>=this.points.close[i-1][1]?"rgba(0, 255, 0, 0.5)":"rgba(255, 0, 0, 0.5)"},this.refreshUpdatedAt=function(){return this.updated_at=Math.round((new Date).valueOf()/1e3)},this.processTrades=function(){var i;return i=this.points.candlestick.length-1,$.each(this.tradesCache,function(_this){return function(ti,trade){return trade.tid>_this.last_tid?(_this.last_ts<=trade.date&&trade.date<_this.next_ts?_this.updatePoint(i,trade):_this.next_ts<=trade.date&&(i=_this.createPoint(i,trade)),_this.last_tid=trade.tid,_this.refreshUpdatedAt()):void 0}}(this)),this.tradesCache=[]},this.prepare=function(k){var candlestick,close,close_price,cur,high,i,low,open,time,trend,vol,volume,_i,_len,_ref;for(_ref=[[],[],[]],volume=_ref[0],candlestick=_ref[1],close_price=_ref[2],i=_i=0,_len=k.length;_len>_i;i=++_i)cur=k[i],time=cur[0],open=cur[1],high=cur[2],low=cur[3],close=cur[4],vol=cur[5],time=1e3*time,trend=i>=1?this.checkTrend(k[i-1],cur):!0,close_price.push([time,close]),candlestick.push([time,open,high,low,close]),volume.push({x:time,y:vol,color:trend?"rgba(0, 255, 0, 0.5)":"rgba(255, 0, 0, 0.5)"});return{minutes:this.minutes,candlestick:candlestick.slice(0,-1),volume:volume.slice(0,-1),close:close_price.slice(0,-1)}},this.handleData=function(data,minutes){return this.minutes=minutes,this.tradesCache=data.trades.concat(this.tradesCache),this.points=this.prepare(data.k),this.last_tid=0,this.last_ts=this.points.candlestick.length>0?this.points.candlestick[this.points.candlestick.length-1][0]/1e3:0,this.next_ts=this.last_ts+60*minutes,this.deliverTrades("market::candlestick::response")},this.deliverTrades=function(event){return this.processTrades(),this.trigger(event,{minutes:this.points.minutes,candlestick:this.points.candlestick.slice(1),close:this.points.close.slice(1),volume:this.points.volume.slice(1)}),this.points.close=this.points.close.slice(-2),this.points.candlestick=this.points.candlestick.slice(-2),this.points.volume=this.points.volume.slice(-2)},this.hardRefresh=function(threshold){var ts;return ts=Math.round((new Date).valueOf()/1e3),ts>this.updated_at+threshold?(this.refreshUpdatedAt(),this.reqK(gon.market.id,this.minutes)):void 0},this.startDeliver=function(){var deliver;return null!=this.interval&&window.clearInterval(this.interval),deliver=function(_this){return function(){return _this.tradesCache.length>0?_this.deliverTrades("market::candlestick::trades"):_this.hardRefresh(300)}}(this),this.interval=setInterval(deliver,999)},this.cacheTrades=function(event,data){return this.tradesCache=Array.prototype.concat(this.tradesCache,data.trades)},this.after("initialize",function(){return this.tradesCache=[],this.on(document,"market::trades",this.cacheTrades),this.on(document,"switch::range_switch",this.load),this.on(document,"market::candlestick::created",this.startDeliver)})})}.call(this),function(){this.MemberData=flight.component(function(){return this.after("initialize",function(){var channel;if(gon.current_user)return channel=this.attr.pusher.subscribe("private-"+gon.current_user.sn),channel.bind("account",function(_this){return function(data){return gon.accounts[data.currency]=data,_this.trigger("account::update",gon.accounts)}}(this)),channel.bind("order",function(_this){return function(data){return _this.trigger("order::"+data.state,data)}}(this)),channel.bind("trade",function(_this){return function(data){return _this.trigger("trade",data)}}(this)),this.trigger("account::update",gon.accounts),gon.my_orders&&this.trigger("order::wait::populate",{orders:gon.my_orders}),gon.my_trades?this.trigger("trade::populate",{trades:gon.my_trades}):void 0})})}.call(this),function(){this.PlaceOrderData=flight.component(function(){return this.onInput=function(event,data){var _ref;return _ref=data.variables,this.input=_ref.input,this.known=_ref.known,this.output=_ref.output,this.order[this.input]=data.value,this.order[this.input]&&this.order[this.known]?this.trigger("place_order::output::"+this.output,this.order):void 0},this.onReset=function(event,data){var _ref;return _ref=data.variables,this.input=_ref.input,this.known=_ref.known,this.output=_ref.output,this.order[this.input]=this.order[this.output]=null,this.trigger("place_order::reset::"+this.output),this.trigger("place_order::order::updated",this.order)},this.after("initialize",function(){return this.order={price:null,volume:null,total:null},this.on("place_order::input",this.onInput),this.on("place_order::reset",this.onReset)})})}.call(this),function(){this.AccountBalanceUI=flight.component(function(){return this.updateAccount=function(event,data){var account,currency,symbol,total,_results;_results=[];for(currency in data)account=data[currency],symbol=gon.currencies[currency].symbol||"",this.$node.find(".account."+currency+" span.balance").text(""+account.balance),this.$node.find(".account."+currency+" span.locked").text(""+account.locked),total=new BigNumber(account.locked).plus(new BigNumber(account.balance)),_results.push(this.$node.find(".account."+currency+" span.total").text(""+symbol+formatter.round(total,2)));return _results},this.updateTotalAssets=function(event,data){var account,currency,fiatCurrency,sum,symbol,ticker;fiatCurrency=gon.fiat_currency,symbol=gon.currencies[fiatCurrency].symbol,sum=0;for(currency in data)account=data[currency],currency===fiatCurrency?(sum+=+account.balance,sum+=+account.locked):(ticker=gon.tickers[""+currency+fiatCurrency])&&(sum+=+account.balance*+ticker.last,sum+=+account.locked*+ticker.last);return this.$node.find(".total-assets").text(" ≈ "+symbol+" "+formatter.round(sum,2))},this.after("initialize",function(){return this.on(document,"account::update",this.updateAccount),this.on(document,"account::update",this.updateTotalAssets)})})}.call(this),function(){this.AccountSummaryUI=flight.component(function(){return this.attributes({total_assets:"#total_assets"}),this.updateAccount=function(event,data){var account,amount,currency,_results;_results=[];for(currency in data)account=data[currency],amount=new BigNumber(account.locked).plus(new BigNumber(account.balance)),this.$node.find("tr."+currency+" span.amount").text(formatter.round(amount,2)),_results.push(this.$node.find("tr."+currency+" span.locked").text(formatter.round(account.locked,2)));return _results},this.updateTotalAssets=function(){var account,currency,fiatCurrency,sum,symbol,ticker,_ref;fiatCurrency=gon.fiat_currency,symbol=gon.currencies[fiatCurrency].symbol,sum=0,_ref=this.accounts;for(currency in _ref)account=_ref[currency],currency===fiatCurrency?(sum+=+account.balance,sum+=+account.locked):(ticker=this.tickers[""+currency+fiatCurrency])&&(sum+=+account.balance*+ticker.last,sum+=+account.locked*+ticker.last);return this.select("total_assets").text(""+symbol+formatter.round(sum,2))},this.after("initialize",function(){return this.accounts=gon.accounts,this.tickers=gon.tickers,this.on(document,"account::update",this.updateAccount),this.on(document,"account::update",function(_this){return function(event,data){return _this.accounts=data,_this.updateTotalAssets()}}(this)),this.on(document,"market::tickers",function(_this){return function(event,data){return _this.tickers=data.raw,_this.updateTotalAssets()}}(this))})})}.call(this),function(){var BORDER_WIDTH,GUTTER,PANEL_PADDING,PANEL_TABLE_HEADER_HIGH;GUTTER=2,PANEL_TABLE_HEADER_HIGH=37,PANEL_PADDING=8,BORDER_WIDTH=1,this.AutoWindowUI=flight.component(function(){return this.after("initialize",function(){var gutter,gutter_2x,gutter_3x,gutter_4x,gutter_5x,gutter_6x,gutter_7x,gutter_8x,gutter_9x,panel_table_header_high;return gutter=GUTTER,gutter_2x=2*GUTTER,gutter_3x=3*GUTTER,gutter_4x=4*GUTTER,gutter_5x=5*GUTTER,gutter_6x=6*GUTTER,gutter_7x=7*GUTTER,gutter_8x=8*GUTTER,gutter_9x=9*GUTTER,panel_table_header_high=PANEL_TABLE_HEADER_HIGH,this.$node.resize(function(){var depths_h,entry_h,markets_h,markets_w,my_orders_h,navbar_h,order_book_w,order_h,ticker_h,trades_h,window_h,window_w;return navbar_h=$(".navbar").height()+BORDER_WIDTH,markets_h=$("#market_list").height()+BORDER_WIDTH,entry_h=$("#ask_entry").height()+2*BORDER_WIDTH,depths_h=$("#depths_wrapper").height()+2*BORDER_WIDTH,my_orders_h=$("#my_orders").height()+2*BORDER_WIDTH,ticker_h=$("#ticker").height()+2*BORDER_WIDTH,window_h=$(this).height(),$(".content").height(window_h-navbar_h),$("#candlestick").height(window_h-navbar_h-gutter_3x),order_h=window_h-navbar_h-entry_h-depths_h-my_orders_h-ticker_h-gutter_6x-2*BORDER_WIDTH,$("#order_book").height(order_h),$("#order_book .panel-body-content").height(order_h-panel_table_header_high-2*PANEL_PADDING),trades_h=window_h-navbar_h-markets_h-gutter_3x-BORDER_WIDTH,$("#market_trades").height(trades_h),$("#market_trades .panel").height(trades_h-2*BORDER_WIDTH),$("#market_trades .panel-body-content").height(trades_h-2*BORDER_WIDTH-panel_table_header_high-2*PANEL_PADDING),window_w=window.innerWidth,markets_w=$("#market_list").width(),order_book_w=$("#order_book").width(),$("#candlestick").width(window_w-order_book_w-markets_w-gutter_4x-20)}),this.$node.resize()})})}.call(this),function(){var COLOR,COLOR_OFF,COLOR_ON,DATETIME_LABEL_FORMAT,DATETIME_LABEL_FORMAT_FOR_TOOLTIP,INDICATOR,RANGE_DEFAULT;"zh-CN"===gon.local&&(DATETIME_LABEL_FORMAT_FOR_TOOLTIP={millisecond:["%m月%e日, %H:%M:%S.%L","%m月%e日, %H:%M:%S.%L","-%H:%M:%S.%L"],second:["%m月%e日, %H:%M:%S","%m月%e日, %H:%M:%S","-%H:%M:%S"],minute:["%m月%e日, %H:%M","%m月%e日, %H:%M","-%H:%M"],hour:["%m月%e日, %H:%M","%m月%e日, %H:%M","-%H:%M"],day:["%m月%e日, %H:%M","%m月%e日, %H:%M","-%H:%M"],week:["%Y年%m月%e日","%Y年%m月%e日","-%m月%e日"],month:["%Y年%m月","%Y年%m月","-%m"],year:["%Y","%Y","-%Y"]}),DATETIME_LABEL_FORMAT={second:"%H:%M:%S",minute:"%H:%M",hour:"%H:%M",day:"%m-%d",week:"%m-%d",month:"%Y-%m",year:"%Y"},RANGE_DEFAULT={fill:"none",stroke:"none","stroke-width":0,r:8,style:{color:"#333"},states:{hover:{fill:"#000",style:{color:"#ccc"}},select:{fill:"#000",style:{color:"#eee"}}}},COLOR_ON={candlestick:{color:"#990f0f",upColor:"#000000",lineColor:"#cc1414",upLineColor:"#49c043"},close:{color:null}},COLOR_OFF={candlestick:{color:"invalid",upColor:"invalid",lineColor:"invalid",upLineColor:"invalid"},close:{color:"invalid"}},COLOR={candlestick:_.extend({},COLOR_OFF.candlestick),close:_.extend({},COLOR_OFF.close)},INDICATOR={MA:!1,EMA:!1},this.CandlestickUI=flight.component(function(){return this.mask=function(){return this.$node.find(".mask").show()},this.unmask=function(){return this.$node.find(".mask").hide()},this.request=function(){return this.mask()},this.init=function(event,data){var _ref;return this.running=!0,null!=(_ref=this.$node.find("#candlestick_chart").highcharts())&&_ref.destroy(),this.initHighStock(data),this.trigger("market::candlestick::created",data)},this.switchType=function(event,data){var chart,colors,key,s,type,val,_i,_len,_ref;for(key in COLOR)val=COLOR[key],_.extend(COLOR[key],COLOR_OFF[key]);if(_.extend(COLOR[data.x],COLOR_ON[data.x]),chart=this.$node.find("#candlestick_chart").highcharts()){for(type in COLOR)for(colors=COLOR[type],_ref=chart.series,_i=0,_len=_ref.length;_len>_i;_i++)s=_ref[_i],null==s.userOptions.algorithm&&s.userOptions.id===type&&s.update(colors,!1);return this.trigger("switch::main_indicator_switch::init")}},this.switchMainIndicator=function(event,data){var chart,indicator,key,s,val,visible,_i,_j,_len,_len1,_ref,_ref1;for(key in INDICATOR)val=INDICATOR[key],INDICATOR[key]=!1;if(INDICATOR[data.x]=!0,chart=this.$node.find("#candlestick_chart").highcharts()){for(_ref=chart.series,_i=0,_len=_ref.length;_len>_i;_i++)s=_ref[_i],"close"===s.userOptions.linkedTo&&s.setVisible(!0,!1);for(indicator in INDICATOR)for(visible=INDICATOR[indicator],_ref1=chart.series,_j=0,_len1=_ref1.length;_len1>_j;_j++)s=_ref1[_j],null!=s.userOptions.algorithm&&s.userOptions.algorithm===indicator&&s.setVisible(visible,!1);return chart.redraw()}},this.default_range=function(unit){return 6e4*unit*100},this.initHighStock=function(data){var component,dataGrouping,range,timeUnits,title,tooltipTemplate,unit;return component=this,range=this.default_range(data.minutes),unit=$("[data-unit="+data.minutes+"]").text(),title=""+gon.market.base_unit.toUpperCase()+"/"+gon.market.quote_unit.toUpperCase()+" - "+unit,timeUnits={millisecond:1,second:1e3,minute:6e4,hour:36e5,day:864e5,week:6048e5,month:26784e5,year:31556952e3},dataGrouping={enabled:!1},tooltipTemplate=JST["templates/tooltip"],DATETIME_LABEL_FORMAT_FOR_TOOLTIP&&(dataGrouping.dateTimeLabelFormats=DATETIME_LABEL_FORMAT_FOR_TOOLTIP),this.$node.find("#candlestick_chart").highcharts("StockChart",{chart:{events:{load:function(_this){return function(){return _this.unmask()}}(this)},animation:!0,marginTop:95,backgroundColor:"rgba(0,0,0, 0.0)"},credits:{enabled:!1},tooltip:{crosshairs:[{width:.5,dashStyle:"solid",color:"#777"},!1],valueDecimals:gon.market.bid.fixed,borderWidth:0,backgroundColor:"rgba(0,0,0,0)",borderRadius:2,shadow:!1,shared:!0,positioner:function(w,h,point){var chart_h,chart_w,grid_h,x,y;return chart_w=$(this.chart.renderTo).width(),chart_h=$(this.chart.renderTo).height(),grid_h=Math.min(20,Math.ceil(chart_h/10)),x=Math.max(10,point.plotX-w-20),y=Math.max(0,Math.floor(point.plotY/grid_h)*grid_h-20),{x:x,y:y}},useHTML:!0,formatter:function(){var chart,dateFormat,dateTimeLabelFormats,fun,index,k,key,series,v;chart=this.points[0].series.chart,series=this.points[0].series,index=this.points[0].point.index,key=this.points[0].key;for(k in timeUnits)if(v=timeUnits[k],v>=series.xAxis.closestPointRange||v<=timeUnits.day&&key%v>0){dateFormat=dateTimeLabelFormats=series.options.dataGrouping.dateTimeLabelFormats[k][0],title=Highcharts.dateFormat(dateFormat,key);break}return fun=function(h,s){return h[s.options.id]=s.data[index],h},tooltipTemplate({title:title,indicator:INDICATOR,format:function(v,fixed){return null==fixed&&(fixed=3),Highcharts.numberFormat(v,fixed)},points:_.reduce(chart.series,fun,{})})}},plotOptions:{candlestick:{turboThreshold:0,followPointer:!0,color:"#990f0f",upColor:"#000000",lineColor:"#cc1414",upLineColor:"#49c043",dataGrouping:dataGrouping},column:{turboThreshold:0,dataGrouping:dataGrouping},trendline:{lineWidth:1},histogram:{lineWidth:1,tooltip:{pointFormat:"<li><span style='color: {series.color};'>{series.name}: <b>{point.y}</b></span></li>"}}},scrollbar:{buttonArrowColor:"#333",barBackgroundColor:"#202020",buttonBackgroundColor:"#202020",trackBackgroundColor:"#202020",barBorderColor:"#2a2a2a",buttonBorderColor:"#2a2a2a",trackBorderColor:"#2a2a2a"},rangeSelector:{enabled:!1},navigator:{maskFill:"rgba(32, 32, 32, 0.6)",outlineColor:"#333",outlineWidth:1,xAxis:{dateTimeLabelFormats:DATETIME_LABEL_FORMAT}},xAxis:{type:"datetime",dateTimeLabelFormats:DATETIME_LABEL_FORMAT,lineColor:"#333",tickColor:"#333",tickWidth:2,range:range,events:{afterSetExtremes:function(e){return"navigator"===e.trigger&&"navigator-drag"===e.triggerOp&&component.liveRange(this.chart)&&!component.running?component.trigger("switch::range_switch::init"):void 0}}},yAxis:[{labels:{enabled:!0,align:"right",x:2,y:3,zIndex:-7},gridLineColor:"#222",gridLineDashStyle:"ShortDot",top:"0%",height:"70%",lineColor:"#fff",minRange:gon.ticker.last?parseFloat(gon.ticker.last)/25:null},{labels:{enabled:!1},top:"70%",gridLineColor:"#000",height:"15%"},{labels:{enabled:!1},top:"85%",gridLineColor:"#000",height:"15%"}],series:[_.extend({id:"candlestick",name:gon.i18n.chart.candlestick,type:"candlestick",data:data.candlestick,showInLegend:!1},COLOR.candlestick),_.extend({id:"close",type:"spline",data:data.close,showInLegend:!1,marker:{radius:0}},COLOR.close),{id:"volume",name:gon.i18n.chart.volume,yAxis:1,type:"column",data:data.volume,color:"#777",showInLegend:!1},{id:"ma5",name:"MA5",linkedTo:"close",showInLegend:!0,type:"trendline",algorithm:"MA",periods:5,color:"#7c9aaa",visible:INDICATOR.MA,marker:{radius:0}},{id:"ma10",name:"MA10",linkedTo:"close",showInLegend:!0,type:"trendline",algorithm:"MA",periods:10,color:"#be8f53",visible:INDICATOR.MA,marker:{radius:0}},{id:"ema7",name:"EMA7",linkedTo:"close",showInLegend:!0,type:"trendline",algorithm:"EMA",periods:7,color:"#7c9aaa",visible:INDICATOR.EMA,marker:{radius:0}},{id:"ema30",name:"EMA30",linkedTo:"close",showInLegend:!0,type:"trendline",algorithm:"EMA",periods:30,color:"#be8f53",visible:INDICATOR.EMA,marker:{radius:0}},{id:"macd",name:"MACD",linkedTo:"close",yAxis:2,showInLegend:!0,type:"trendline",algorithm:"MACD",color:"#7c9aaa",marker:{radius:0}},{id:"sig",name:"SIG",linkedTo:"close",yAxis:2,showInLegend:!0,type:"trendline",algorithm:"signalLine",color:"#be8f53",marker:{radius:0}},{id:"hist",name:"HIST",linkedTo:"close",yAxis:2,showInLegend:!0,type:"histogram",color:"#990f0f"}]})},this.formatPointArray=function(point){return{x:point[0],open:point[1],high:point[2],low:point[3],close:point[4]}},this.createPointOnSeries=function(chart,i,px,point){return chart.series[i].addPoint(point,!0,!0)},this.createPoint=function(chart,data,i){return this.createPointOnSeries(chart,0,data.candlestick[i][0],data.candlestick[i]),this.createPointOnSeries(chart,1,data.close[i][0],data.close[i]),this.createPointOnSeries(chart,2,data.volume[i].x,data.volume[i]),chart.redraw(!0)},this.updatePointOnSeries=function(chart,i,px,point){var last;return chart.series[i].points?(last=chart.series[i].points[chart.series[i].points.length-1],px===last.x?last.update(point,!1):console.log("Error update on series "+i+": px="+px+" lastx="+last.x)):void 0},this.updatePoint=function(chart,data,i){return this.updatePointOnSeries(chart,0,data.candlestick[i][0],this.formatPointArray(data.candlestick[i])),this.updatePointOnSeries(chart,1,data.close[i][0],data.close[i][1]),this.updatePointOnSeries(chart,2,data.volume[i].x,data.volume[i]),chart.redraw(!0)},this.process=function(chart,data){var current,current_point,i,_i,_ref,_results;for(_results=[],i=_i=0,_ref=data.candlestick.length-1;_ref>=0?_ref>=_i:_i>=_ref;i=_ref>=0?++_i:--_i)current=chart.series[0].points.length-1,current_point=chart.series[0].points[current],data.candlestick[i][0]>current_point.x?_results.push(this.createPoint(chart,data,i)):_results.push(this.updatePoint(chart,data,i));return _results},this.updateByTrades=function(event,data){var chart;return chart=this.$node.find("#candlestick_chart").highcharts(),this.liveRange(chart)?this.process(chart,data):this.running=!1},this.liveRange=function(chart){var p1,p2;return p1=chart.series[0].points[chart.series[0].points.length-1].x,p2=chart.series[10].points[chart.series[10].points.length-1].x,p1===p2},this.after("initialize",function(){return this.on(document,"market::candlestick::request",this.request),this.on(document,"market::candlestick::response",this.init),this.on(document,"market::candlestick::trades",this.updateByTrades),this.on(document,"switch::main_indicator_switch",this.switchMainIndicator),this.on(document,"switch::type_switch",this.switchType)})})}.call(this),function(){this.DepthUI=flight.component(function(){return this.attributes({chart:"#depths"}),this.refresh=function(event,data){var chart;return chart=this.select("chart").highcharts(),chart.series[0].setData(data.bids.reverse(),!1),chart.series[1].setData(data.asks,!1),chart.xAxis[0].setExtremes(data.low,data.high),chart.redraw()},this.initChart=function(){return this.select("chart").highcharts({chart:{margin:0,height:100,backgroundColor:"rgba(0,0,0,0)"},title:{text:""},credits:{enabled:!1},legend:{enabled:!1},rangeSelector:{enabled:!1},xAxis:{labels:{enabled:!1}},yAxis:{min:0,gridLineColor:"#333",gridLineDashStyle:"ShortDot",title:{text:""},labels:{enabled:!1}},tooltip:{valueDecimals:4,headerFormat:"<table class=depths-table><tr>\n  <th><span>{series.name}</span> "+gon.i18n.chart.price+"</th><th>"+gon.i18n.chart.depth+"</th>\n</tr>",pointFormat:"<tr><td>{point.x}</td><td>{point.y}</td></tr>",footerFormat:"</table>",borderWidth:0,backgroundColor:"rgba(0,0,0,0)",borderRadius:0,shadow:!1,useHTML:!0,shared:!0,positioner:function(){return{x:128,y:28}}},series:[{name:gon.i18n.bid,type:"area",fillColor:"rgba(77, 215, 16, 0.5)",lineColor:"rgb(77, 215, 16)",color:"transparent",animation:{duration:1e3}},{name:gon.i18n.ask,type:"area",animation:{duration:1e3},fillColor:"rgba(208, 0, 23, 0.3)",lineColor:"rgb(208, 0, 23)",color:"transparent"}]})},this.after("initialize",function(){return this.initChart(),this.on(document,"market::depth::response",this.refresh),this.on(document,"market::depth::fade_toggle",function(){return this.$node.fadeToggle()
Binary file tmp/cache/assets/production/sprockets/7513f57e41c8a5611bd6c4a502e1ca12 matches
Binary file tmp/cache/assets/production/sprockets/0d3881005b0646df783d5c24683d34f5 matches
Binary file tmp/cache/assets/production/sprockets/dd5677f7ee2a01e091dda542ed12a3d1 matches
Binary file tmp/cache/assets/production/sprockets/bdbd16276007fbc2c1bbf4331c8521d3 matches
Binary file tmp/cache/assets/production/sprockets/8306efb73b1b621f55563ff8bf66a4c4 matches
Binary file tmp/cache/assets/production/sprockets/3ec8af57aa13c27aa0eb0049f1028e5d matches
Binary file tmp/cache/assets/production/sprockets/5ad255b71301efd1e11013833ea235c4 matches
Binary file tmp/cache/assets/production/sprockets/94e7b9128bcc68ab19ce471a5e85f58f matches
Binary file tmp/cache/assets/production/sprockets/86e145a39f85cceeaffdff91ebb61449 matches
